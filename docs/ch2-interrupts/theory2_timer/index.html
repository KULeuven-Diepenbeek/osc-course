<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.79.1" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>2.3 The timer :: Operating Systems and C</title>

    
    <link href="../../css/nucleus.css?1614687717" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1614687717" rel="stylesheet">
    <link href="../../css/hybrid.css?1614687717" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1614687717" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1614687717" rel="stylesheet">
    <link href="../../css/auto-complete.css?1614687717" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1614687717" rel="stylesheet">
    <link href="../../css/theme.css?1614687717" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1614687717" rel="stylesheet">
    
    <link href="../../css/theme-kul.css?1614687717" rel="stylesheet">
    
    

    <script src="../../js/jquery-3.3.1.min.js?1614687717"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
      <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

<script>
window.MathJax = {
  chtml: {
    scale: 2,                      
    minScale: .5,                  
    matchFontHeight: true,         
    mtextInheritFont: false,       
    merrorInheritFont: true,       
    mathmlSpacing: false,          
    skipAttributes: {},            
    exFactor: .5,                  
    displayAlign: 'center',        
    displayIndent: '0'             
  }
};
</script>

<script src=../../js/osc.js></script>
  </head>
  <body class="" data-url="../../ch2-interrupts/theory2_timer/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
	<img src="../../img/style/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
	<img src="../../img/style/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1614687717"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1614687717"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/kuleuven-diepenbeek.github.io\/osc-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1614687717"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='../../'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ch1-c/" title="1: Introduction in C" class="dd-item
        
        
        
        ">
      <a href="../../ch1-c/">
          <i class='far fa-keyboard'></i> 1: Introduction in C
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/intro/" title="1.1: The C programming language" class="dd-item ">
        <a href="../../ch1-c/intro/">
        <i class='fas fa-book'></i> 1.1: The C programming language
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/intro-labs/" title="1.2: String Manipulation" class="dd-item ">
        <a href="../../ch1-c/intro-labs/">
        <i class='fas fa-vial'></i> 1.2: String Manipulation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/structs/" title="1.3: Creating order: Structures" class="dd-item ">
        <a href="../../ch1-c/structs/">
        <i class='fas fa-book'></i> 1.3: Creating order: Structures
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/structs-labs/" title="1.4: Structs" class="dd-item ">
        <a href="../../ch1-c/structs-labs/">
        <i class='fas fa-vial'></i> 1.4: Structs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/ecosystems/" title="1.5: C Ecosystems" class="dd-item ">
        <a href="../../ch1-c/ecosystems/">
        <i class='fas fa-book'></i> 1.5: C Ecosystems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/ecosystems-labs/" title="1.6: Splitting up Code" class="dd-item ">
        <a href="../../ch1-c/ecosystems-labs/">
        <i class='fas fa-vial'></i> 1.6: Splitting up Code
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch2-interrupts/" title="2: Interrupts" class="dd-item
        parent
        
        
        ">
      <a href="../../ch2-interrupts/">
          <i class='fab fa-linux'></i> 2: Interrupts
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch2-interrupts/theory1_arduino/" title="2.1 Arduino UNO" class="dd-item ">
        <a href="../../ch2-interrupts/theory1_arduino/">
        <i class='fab fa-linux'></i> 2.1 Arduino UNO
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-interrupts/lab1_arduino-multfreq/" title="2.2: Arduino multi frequencies" class="dd-item ">
        <a href="../../ch2-interrupts/lab1_arduino-multfreq/">
        <i class='fas fa-vial'></i> 2.2: Arduino multi frequencies
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-interrupts/theory2_timer/" title="2.3 The timer" class="dd-item active">
        <a href="../../ch2-interrupts/theory2_timer/">
        <i class='fab fa-linux'></i> 2.3 The timer
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-interrupts/lab2_rocketlaunch/" title="2.4: Launch that rocket !!" class="dd-item ">
        <a href="../../ch2-interrupts/lab2_rocketlaunch/">
        <i class='fas fa-vial'></i> 2.4: Launch that rocket !!
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch3-pointers/" title="3: Pointers &amp; Arrays" class="dd-item
        
        
        
        ">
      <a href="../../ch3-pointers/">
          <i class='far fa-keyboard'></i> 3: Pointers &amp; Arrays
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch3-pointers/pointers/" title="3.1: Pointers and arrays" class="dd-item ">
        <a href="../../ch3-pointers/pointers/">
        <i class='far fa-keyboard'></i> 3.1: Pointers and arrays
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-pointers/practical-use/" title="3.2: Practical Use of Pointers" class="dd-item ">
        <a href="../../ch3-pointers/practical-use/">
        <i class='far fa-keyboard'></i> 3.2: Practical Use of Pointers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-pointers/lab/" title="3.3: The Ancient Library" class="dd-item ">
        <a href="../../ch3-pointers/lab/">
        <i class='fas fa-vial'></i> 3.3: The Ancient Library
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch4-debugging/" title="4: Debugging" class="dd-item
        
        
        
        ">
      <a href="../../ch4-debugging/">
          <i class='far fa-keyboard'></i> 4: Debugging
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch4-debugging/debugging-ide/" title="4.1: The Easy Way: IDEs" class="dd-item ">
        <a href="../../ch4-debugging/debugging-ide/">
        <i class='far fa-keyboard'></i> 4.1: The Easy Way: IDEs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-debugging/debugging-gdb/" title="4.2: The Hard Way: GDB" class="dd-item ">
        <a href="../../ch4-debugging/debugging-gdb/">
        <i class='fas fa-vial'></i> 4.2: The Hard Way: GDB
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-debugging/testing/" title="4.3: The Middle Way: TDD" class="dd-item ">
        <a href="../../ch4-debugging/testing/">
        <i class='far fa-keyboard'></i> 4.3: The Middle Way: TDD
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch5-introos/" title="5: Intro in OS" class="dd-item
        
        
        
        ">
      <a href="../../ch5-introos/">
          <i class='fab fa-linux'></i> 5: Intro in OS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch5-introos/intro-os/" title="5.1: Intro to OS using Linux" class="dd-item ">
        <a href="../../ch5-introos/intro-os/">
        <i class='fas fa-book'></i> 5.1: Intro to OS using Linux
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch5-introos/lab1_wetfeet/" title="5.2: Getting your CLI-feet wet" class="dd-item ">
        <a href="../../ch5-introos/lab1_wetfeet/">
        <i class='fas fa-vial'></i> 5.2: Getting your CLI-feet wet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch6-tasks/" title="6: Task management" class="dd-item
        
        
        
        ">
      <a href="../../ch6-tasks/">
          <i class='fab fa-linux'></i> 6: Task management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/processes/" title="6.1: Processes" class="dd-item ">
        <a href="../../ch6-tasks/processes/">
        <i class='fas fa-book'></i> 6.1: Processes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab1_processmgmt/" title="6.2: Processes (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab1_processmgmt/">
        <i class='fas fa-vial'></i> 6.2: Processes (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/threads/" title="6.3: Threads" class="dd-item ">
        <a href="../../ch6-tasks/threads/">
        <i class='fas fa-book'></i> 6.3: Threads
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab2_threadsmgmt/" title="6.4: Threads (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab2_threadsmgmt/">
        <i class='fas fa-vial'></i> 6.4: Threads (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/intertasks/" title="6.5: Inter task communication" class="dd-item ">
        <a href="../../ch6-tasks/intertasks/">
        <i class='fas fa-book'></i> 6.5: Inter task communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab3_intertaskcomm/" title="6.6: Inter task communication (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab3_intertaskcomm/">
        <i class='fas fa-vial'></i> 6.6: Inter task communication (lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch7-scheduling/" title="7: CPU scheduling" class="dd-item
        
        
        
        ">
      <a href="../../ch7-scheduling/">
          <i class='fab fa-linux'></i> 7: CPU scheduling
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/algorithms/" title="7.1: Scheduling algorithms" class="dd-item ">
        <a href="../../ch7-scheduling/algorithms/">
        <i class='fas fa-book'></i> 7.1: Scheduling algorithms
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab1_algorithms/" title="7.2: Scheduling algorithms (lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab1_algorithms/">
        <i class='fas fa-vial'></i> 7.2: Scheduling algorithms (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/towards/" title="7.3: Towards real-world schedulers" class="dd-item ">
        <a href="../../ch7-scheduling/towards/">
        <i class='fas fa-book'></i> 7.3: Towards real-world schedulers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab2_niceguy/" title="7.4: Mr. nice guy(lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab2_niceguy/">
        <i class='fas fa-vial'></i> 7.4: Mr. nice guy(lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch8-stack/" title="8: The Stack &amp; The Heap" class="dd-item
        
        
        
        ">
      <a href="../../ch8-stack/">
          <i class='far fa-keyboard'></i> 8: The Stack &amp; The Heap
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/stackvsheap/" title="8.1: The Stack &amp; the Heap" class="dd-item ">
        <a href="../../ch8-stack/stackvsheap/">
        <i class='fas fa-book'></i> 8.1: The Stack &amp; the Heap
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/inspection-labs/" title="8.2: Inspecting memory regions" class="dd-item ">
        <a href="../../ch8-stack/inspection-labs/">
        <i class='fas fa-vial'></i> 8.2: Inspecting memory regions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/scope/" title="8.3: Different Scopes in C" class="dd-item ">
        <a href="../../ch8-stack/scope/">
        <i class='fas fa-book'></i> 8.3: Different Scopes in C
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch9-memory/" title="9: Memory Management" class="dd-item
        
        
        
        ">
      <a href="../../ch9-memory/">
          <i class='fab fa-linux'></i> 9: Memory Management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/memory/" title="9.1: Memory management" class="dd-item ">
        <a href="../../ch9-memory/memory/">
        <i class='fas fa-book'></i> 9.1: Memory management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab1_segfault/" title="9.2: Deliberate Segfaulting" class="dd-item ">
        <a href="../../ch9-memory/lab1_segfault/">
        <i class='fas fa-vial'></i> 9.2: Deliberate Segfaulting
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/paging/" title="9.3: Paging" class="dd-item ">
        <a href="../../ch9-memory/paging/">
        <i class='fas fa-book'></i> 9.3: Paging
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab2_browsing/" title="9.4: Simply browsing through pages" class="dd-item ">
        <a href="../../ch9-memory/lab2_browsing/">
        <i class='fas fa-vial'></i> 9.4: Simply browsing through pages
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/chx-cs/" title="X: Capita Selecta" class="dd-item
        
        
        
        ">
      <a href="../../chx-cs/">
          <i class='fab fa-linux'></i> X: Capita Selecta
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/filesystems/" title="X.1: File systems" class="dd-item ">
        <a href="../../chx-cs/filesystems/">
        <i class='fab fa-linux'></i> X.1: File systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/rtos/" title="X.2: Real-time Operating Systems" class="dd-item ">
        <a href="../../chx-cs/rtos/">
        <i class='fab fa-linux'></i> X.2: Real-time Operating Systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/devdrivers/" title="X.3: Device Drivers" class="dd-item ">
        <a href="../../chx-cs/devdrivers/">
        <i class='fab fa-linux'></i> X.3: Device Drivers
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/exercises/" title="A. Exercises Assignments" class="dd-item
        
        
        
        ">
      <a href="../../exercises/">
          <i class='fas fa-pencil-alt'></i> A. Exercises Assignments
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/exercises/c-integrated-ex/" title="1. Integrated C exercise" class="dd-item ">
        <a href="../../exercises/c-integrated-ex/">
        <i class='fas fa-pen-square'></i> 1. Integrated C exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/c-debugging-testing/" title="2. Testing in C(&#43;&#43;)" class="dd-item ">
        <a href="../../exercises/c-debugging-testing/">
        <i class='fas fa-pen-square'></i> 2. Testing in C(&#43;&#43;)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/tasks_inter_thread_communication/" title="3. Inter-thread communication" class="dd-item ">
        <a href="../../exercises/tasks_inter_thread_communication/">
        <i class='fas fa-pen-square'></i> 3. Inter-thread communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/scheduler/" title="4. Pseudo scheduler" class="dd-item ">
        <a href="../../exercises/scheduler/">
        <i class='fas fa-pen-square'></i> 4. Pseudo scheduler
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/appendix/" title="B. Appendix" class="dd-item
        
        
        
        ">
      <a href="../../appendix/">
          <i class='fab fa-github'></i> B. Appendix
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/appendix/lab_ll_rtos/" title="3.3: The Ancient Library (RTOS)" class="dd-item ">
        <a href="../../appendix/lab_ll_rtos/">
        <i class='fas fa-vial'></i> 3.3: The Ancient Library (RTOS)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/reading/" title="1. Recommended reading" class="dd-item ">
        <a href="../../appendix/reading/">
        1. Recommended reading
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/installing/" title="2. Linux Installation Instructions" class="dd-item ">
        <a href="../../appendix/installing/">
        2. Linux Installation Instructions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/cheat_sheet/" title="Cheat sheet" class="dd-item ">
        <a href="../../appendix/cheat_sheet/">
        Cheat sheet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://uhintra03.uhasselt.be/studiegidswww/opleidingsonderdeel.aspx?a=2019&amp;i=4082&amp;n=4&amp;t=01"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://kuleuven-diepenbeek.github.io/osc-course/TODO"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Operating Systems and C</a> > <a href='../../ch2-interrupts/'>2: Interrupts</a> > 2.3 The timer
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#16-bit-timer">16-bit Timer</a></li>
<li><a href="#timer-frequency">Timer frequency</a></li>
<li><a href="#polling-vs-interrupt">Polling vs Interrupt</a></li>
<li><a href="#configuring-the-timer-with-interrupts">Configuring the timer with interrupts</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              2.3 The timer
            </h1>
          

        




<p>With our sleeves rolled up and dirt all the way up to our elbows, it&rsquo;s time to grab a coffee and do so reading/studying again. In this section <strong>interrupts</strong> will be introduced through the use of a timer.</p>

<p>A lot of applications that are built using an Arduino need some sense of <strong>time</strong>. As mentioned earlier the ATMega has 3 dedicated timers on chip: two 8-bit timers and one 16-bit timer. Through these timers the concept of time can be implemented.</p>

<h2 id="16-bit-timer">16-bit Timer</h2>

<p>One component that is in almost every microcontroller is a Timer/counter. This timer/counter can be used for many things: stopwatch, wave generation, timing, &hellip; The block diagram of the 16-bit timer/counter in the Arduino is shown here. Next to this 16-bit timer/counter there are 2 8-bit timer/counters available. The documentation reports registers like TCNTn and OCnB. The letter n is a placeholder for the number of the timer. In the case of the micro controller on the Arduino, the 16-bit counter results in <strong>n = 1</strong>.</p>

<figure>
    <img src="../../img/0x_12.png"/> <figcaption>
            <h4>Block Diagram of the 16-bit counter in the Arduino microcontroller. Source: arduino.cc</h4>
        </figcaption>
</figure>


<p>During <strong>normal operation</strong> the counter simply <em>counts</em> from 0x0 to its maximum value.. The left-side image below shows what happens to the 16-bit value <strong>TCNT1</strong>. The counter can also be used in a different mode: <strong>Clear-timer-on-compare (CTC)</strong>. In this mode the timer starts again at 0x0000, but only counts to a certain value. When this value is reached, the counter resets and starts over. The right-side image below shows the CTC mode with the cap at <strong>0x7FFF</strong> and at <span style="color:red"><strong>0x3FFF</strong></span>.</p>

<div style="display: flex; flex-direction: row; align-items: center;">
  <div style="width: 50%">
    <figure>
    <img src="../../img/jo/timer_normal.jpg" width="200%"/> <figcaption>
            <h4>Value of TCNT during normal operation of the 16-bit counter.</h4>
        </figcaption>
</figure>

  </div>
  <div style="width: 50%">
    <figure>
    <img src="../../img/jo/timer_ctc.jpg" width="200%"/> <figcaption>
            <h4>Value of TCNT during clear-timer-on-compare (CTC) operation of the 16-bit counter.</h4>
        </figcaption>
</figure>

  </div>
</div>

<p>The value to which the timer counts in CTC mode can be set through the register <strong>OCR1A</strong>: the <strong>O</strong>utput <strong>C</strong>ompare <strong>R</strong>egister of timer <strong>1</strong> named <strong>A</strong>. As can be seen in the block diagram, there is a comparator in the <em>Timer</em> block that compares TCNT1 and OCR1A. The result of this comparator can be evaluated in the control logic. By configuring the timer this control logic can be altered.</p>


<div class="ex">
	<div class="inner">
    	<p>What is the frequency at which the counter reaches its maximum value in <strong>normal</strong> mode ?</p>

	</div>
</div>

<h2 id="timer-frequency">Timer frequency</h2>

<p>To determine the frequency at which the counter operates a quick visit to the datasheet holds the answer. The <strong>clk<sub>T1</sub></strong> can be generated from an external or internal clock source: <strong>clk<sub>I/O</sub></strong>. This incoming clock goes through a prescaler which can be set  by the Clock Select bits (CS12, CS11, and CS10).</p>

<div style="display: flex; flex-direction: row; align-items: center;">
  <div style="width: 50%">
    <figure>
    <img src="../../img/clock_distribution.png"/> <figcaption>
            <h4>Clock Distribution (source: Datasheet)</h4>
        </figcaption>
</figure>

  </div>
  <div style="width: 50%">
    <figure>
    <img src="../../img/timer_cs1x.png"/> <figcaption>
            <h4>Clock Select bits for prescaler cconfiguration (source: Datasheet)</h4>
        </figcaption>
</figure>

  </div>
</div>

<p>To introduce a clock, a <a href="https://en.wikipedia.org/wiki/Crystal_oscillator" target="_blank">
crystal oscillator
</a>
 is used. The one on the Arduino UNO board runs at a frequency of 16&rsquo;000&rsquo;000 Hz or 16 MHz. This is the frequency at which the CPU is working, often referred to as the <em>clock speed</em>. Given that frequency, and the value of the pre-scaler, the clock frequency at which the counter operates can be calculated.</p>

<p style="text-align:center;">
  \( 
f_{clk_{T1}} = { f_{clk_{I/O}} \over prescaler_{T1}} = { 16e6 \over 2^{10}} = 15'625 Hz
 \)
</p>

<p>Because the counter needs 2<sup>16</sup> clock ticks to reach its maximum, this maximum will be reached every \( 2^{16} \over 15625 \) = 4.19 s. If a LED were to be toggled every time the counter reaches its maximum, the frequency of the toggling LED would be (<strong>2</strong> * 4.19 s)<sup>-1</sup> = 0.119 Hz.</p>

<figure>
    <img src="../../img/jo/timer_time.jpg" width="50%"/> <figcaption>
            <h4>Value of TCNT during clear-timer-on-compare (CTC) operation of the 16-bit counter.</h4>
        </figcaption>
</figure>


<h2 id="polling-vs-interrupt">Polling vs Interrupt</h2>

<p>Before you put down your coffee to get back to work let&rsquo;s discuss polling first. A nice illustration of polling is shown below.</p>

<p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/O_sO39FXL68" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

&nbsp;</p>

<p>Our toddler is <strong>polling</strong> her father. Another example of polling is shown below. This clip, however, ends with an <strong>interrupt</strong>.</p>

<p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/18AzodTPG5U" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

&nbsp;</p>

<p>Would it not be nice that the CPU could just continue working on something else until a certain event occurs eg. the timer reaching its maximum value ? In the second example (the one with the cartoon), the <em>co-pilot</em> <strong>interrupts</strong> what <em>the processor</em> was doing.</p>

<p>An <strong>interrupt</strong> is a signal that goes to the processor signalling a certain event. There are two sources for this interrupt: hardware and software. The timer that reaches his maximum count and signals this to the processor is an example of a <strong>hardware interrupt</strong>. An example for a <strong>software interrupt</strong> could be an attempt of a division by zero.</p>

<h2 id="configuring-the-timer-with-interrupts">Configuring the timer with interrupts</h2>

<p>As can be seen from the block diagram on the top of this page, 4 registers are available for interaction with the software:</p>

<ul>
<li><strong>TCNTn:</strong> Timer/counter value for counter n</li>
<li><strong>OCRnA/OCRn:</strong> Output Compare Register A for counter n (also available for B)</li>
<li><strong>ICRn:</strong> Input Capture Register</li>
<li><strong>TCCRnA:</strong> Timer/Counter Control Register for counter n</li>
</ul>

<p>The first three registers (TCNT, OCRA/OCRB, and ICR) are all 16-bit registers. Their functionality is self-explanatory. The Control Register needs more explanation, though. Luckily for us, there is &hellip; the datasheet.</p>

<figure>
    <img src="../../img/TCCR1.png"/> <figcaption>
            <h4>Timer/Counter Configuration Register 1 (TCCR1)</h4>
        </figcaption>
</figure>

<p>The following configuration are given. For other configuration the reader is invited to consult the datasheet for him/herself.</p>

<ul>
<li><strong>CS12 | CS11 | CS10 :</strong> Clock Select as explained above. Dividing the incoming clock with a 1024-bit prescaler gives configuration: <strong>101</strong>.</li>
<li><strong>WGM13 | WGM12 | WGM11 | WGM10 :</strong> Waveform Generation Mode. This is the formal name for the <em>normal mode</em> or the <em>CTC mode</em> that were discussed above. Normal mode of operation is achieved by setting these bits to: <strong>0000</strong></li>
<li><strong>IC.. :</strong> Input Capture (Noise Cancellation and Edge Select) are irrelevant for this mode of operation and can be both set to: <strong>0</strong></li>
<li><strong>COM1.. :</strong> What should happen when OCRA or OCRB can be chosen from 4 different options (hence the 2 bits). Both these settings are irrelevant for this mode of operation and can be both set to: <strong>00</strong></li>
</ul>

<p>In summary, TCCR1A should be set to <strong>0b00000000</strong> (or <strong>0x00</strong>) and TCCR1B should be set to <strong>0b00000101</strong> (or <strong>0x05</strong>).</p>

<p>The settings above configure TIMER/COUNTER 1 to operate like requested, but the interrupts still have to be set. To set this, two different flags need to be enabled. In the final section of this chapter these two flags are elaborated on. For now, it suffices to know there is a <strong>general Interrupt Enable</strong> and a <strong>&lsquo;maskable&rsquo; Interrupt Enable</strong>. The former can be set by calling the function <strong>sie()</strong> the latter should be set through a register: Timer Interrupt Mask Register (TIMSK1).</p>

<figure>
    <img src="../../img/TIMSK1.png"/> <figcaption>
            <h4>Timer Interrupt Mask Register (TIMSK1)</h4>
        </figcaption>
</figure>

<p>As can be seen from the image above, there are other Interrupts that can be set. For this example only the final one (Timer Overflow Interrupt Enable) should be set to one. This results in setting TIMSK1 to <strong>0b00000001</strong> (or <strong>0x01</strong>).</p>

<p>Finally, when the interrupt is triggered, something should happen. Otherwise this would be quite useless. When an interrupt occurs, the processor <strong>halts</strong> whatever it was doing and executes a <em>function</em>. In stead of &ldquo;calling&rdquo; the function ourselves, this function call is done automatically. To be able to distinguish between different interrupt sources, different prefixed function names are available. The next section of this chapter will elaborate on this as well. The function-name that is linked to the TIMER/COUNTER 1 overflowing is: <strong>TIMER1_OVF_vect</strong>.</p>

<p>The example code below puts <strong>everything together</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#define LED_1Hz 7
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> led0_status <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

ISR(TIMER1_OVF_vect) {
  <span style="color:#66d9ef">if</span>(led0_status <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
    led0_status <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    digitalWrite(LED_1Hz, LOW);
  } <span style="color:#66d9ef">else</span> {
    led0_status <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
    digitalWrite(LED_1Hz, HIGH);
  }
}

<span style="color:#66d9ef">void</span> setup()
{
  pinMode(LED_1Hz, OUTPUT);
  
  <span style="color:#75715e">/* configure TIMER/COUNTER 1 */</span>
  TCCR1A <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00</span>;
  TCCR1B <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x05</span>;

  <span style="color:#75715e">/* enable the interrupts */</span>
  sei();
}

<span style="color:#66d9ef">void</span> loop() {

}</code></pre></div>
<!-- 
<div class="notices note" ><p>The C-file above can be found in the Virtual Machine as <strong>/home/osc/osc-exercises/ch2_interrupts/example2.c</strong></p>
</div>
 -->


<div class="ex">
	<div class="inner">
    	<p>Compile and run the code above. What is the frequency at which the LED toggles ?</p>

	</div>
</div>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../ch2-interrupts/lab1_arduino-multfreq/" title="2.2: Arduino multi frequencies"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../ch2-interrupts/lab2_rocketlaunch/" title="2.4: Launch that rocket !!" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1614687717"></script>
    <script src="../../js/perfect-scrollbar.min.js?1614687717"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1614687717"></script>
    <script src="../../js/jquery.sticky.js?1614687717"></script>
    <script src="../../js/featherlight.min.js?1614687717"></script>
    <script src="../../js/highlight.pack.js?1614687717"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js?1614687717"></script>
    <script src="../../js/learn.js?1614687717"></script>
    <script src="../../js/hugo-learn.js?1614687717"></script>
    
        
            <script src="../../mermaid/mermaid.js?1614687717"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

