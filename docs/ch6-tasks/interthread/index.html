<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>6.6: Inter Thread communication :: Operating Systems and C</title>

    
    <link href="../../css/nucleus.css?1679059470" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1679059470" rel="stylesheet">
    <link href="../../css/hybrid.css?1679059470" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1679059470" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1679059470" rel="stylesheet">
    <link href="../../css/auto-complete.css?1679059470" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1679059470" rel="stylesheet">
    <link href="../../css/theme.css?1679059470" rel="stylesheet">
    <link href="../../css/devselector.css?1679059470" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1679059470" rel="stylesheet">
    <link href="../../css/theme-kul.css?1679059470" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1679059470"></script>
    <script src="../../js/devselector.js?1679059470"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    <script src="../../js/osc.js"></script>

  </head>
  <body class="" data-url="../../ch6-tasks/interthread/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../images/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../images/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1679059470"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1679059470"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/kuleuven-diepenbeek.github.io\/osc-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1679059470"></script>

    
  </div>

    <div class="highlightable">

      <h3><a href="../../">Course Contents</a></h3>
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ch1-introos/" title="1: Intro in OS" class="dd-item
        
        
        
        ">
      <a href="../../ch1-introos/">
          <i class='fab fa-linux'></i> 1: Intro in OS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/intro-os/" title="1.1: Intro to OS using Linux" class="dd-item ">
        <a href="../../ch1-introos/intro-os/">
        <i class='fas fa-book'></i> 1.1: Intro to OS using Linux
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/filesystems/" title="1.2: File systems" class="dd-item ">
        <a href="../../ch1-introos/filesystems/">
        <i class='fab fa-linux'></i> 1.2: File systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/cli/" title="1.3: Getting your CLI-feet wet" class="dd-item ">
        <a href="../../ch1-introos/cli/">
        <i class='fas fa-vial'></i> 1.3: Getting your CLI-feet wet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch2-c/" title="2: Introduction in C" class="dd-item
        
        
        
        ">
      <a href="../../ch2-c/">
          <i class='far fa-keyboard'></i> 2: Introduction in C
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/intro/" title="2.1: The C programming language" class="dd-item ">
        <a href="../../ch2-c/intro/">
        <i class='fas fa-book'></i> 2.1: The C programming language
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/intro-labs/" title="2.2: String Manipulation" class="dd-item ">
        <a href="../../ch2-c/intro-labs/">
        <i class='fas fa-vial'></i> 2.2: String Manipulation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/structs/" title="2.3: Creating order: Structures" class="dd-item ">
        <a href="../../ch2-c/structs/">
        <i class='fas fa-book'></i> 2.3: Creating order: Structures
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/structs-labs/" title="2.4: Structs" class="dd-item ">
        <a href="../../ch2-c/structs-labs/">
        <i class='fas fa-vial'></i> 2.4: Structs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/ecosystems/" title="2.5: C Ecosystems" class="dd-item ">
        <a href="../../ch2-c/ecosystems/">
        <i class='fas fa-book'></i> 2.5: C Ecosystems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/ecosystems-labs/" title="2.6: Splitting up Code" class="dd-item ">
        <a href="../../ch2-c/ecosystems-labs/">
        <i class='fas fa-vial'></i> 2.6: Splitting up Code
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch3-introcpu/" title="3: Introduction in CPU" class="dd-item
        
        
        
        ">
      <a href="../../ch3-introcpu/">
          <i class='fab fa-linux'></i> 3: Introduction in CPU
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/1_vonneumann/" title="3.1 Von Neumann Architecture" class="dd-item ">
        <a href="../../ch3-introcpu/1_vonneumann/">
        <i class='fab fa-linux'></i> 3.1 Von Neumann Architecture
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/1_lab_assembly/" title="3.2: Assembly basics" class="dd-item ">
        <a href="../../ch3-introcpu/1_lab_assembly/">
        <i class='fas fa-vial'></i> 3.2: Assembly basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/2_functions/" title="3.3 Functions and The Stack" class="dd-item ">
        <a href="../../ch3-introcpu/2_functions/">
        <i class='fab fa-linux'></i> 3.3 Functions and The Stack
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/2_lab_stack/" title="3.4: The Stack" class="dd-item ">
        <a href="../../ch3-introcpu/2_lab_stack/">
        <i class='fas fa-vial'></i> 3.4: The Stack
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch4-pointers/" title="4: Pointers &amp; Arrays" class="dd-item
        
        
        
        ">
      <a href="../../ch4-pointers/">
          <i class='far fa-keyboard'></i> 4: Pointers &amp; Arrays
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/pointers/" title="4.1: Pointers and arrays" class="dd-item ">
        <a href="../../ch4-pointers/pointers/">
        <i class='far fa-keyboard'></i> 4.1: Pointers and arrays
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/practical-use/" title="4.2: Practical Use of Pointers" class="dd-item ">
        <a href="../../ch4-pointers/practical-use/">
        <i class='far fa-keyboard'></i> 4.2: Practical Use of Pointers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/lab/" title="4.3: The Ancient Library" class="dd-item ">
        <a href="../../ch4-pointers/lab/">
        <i class='fas fa-vial'></i> 4.3: The Ancient Library
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch5-debugging/" title="5: Debugging" class="dd-item
        
        
        
        ">
      <a href="../../ch5-debugging/">
          <i class='far fa-keyboard'></i> 5: Debugging
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/debugging-ide/" title="5.1: The Easy Way: IDEs" class="dd-item ">
        <a href="../../ch5-debugging/debugging-ide/">
        <i class='far fa-keyboard'></i> 5.1: The Easy Way: IDEs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/testing/" title="5.3: The Middle Way: TDD" class="dd-item ">
        <a href="../../ch5-debugging/testing/">
        <i class='far fa-keyboard'></i> 5.3: The Middle Way: TDD
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/debugging-gdb/" title="5.2: The Hard Way: GDB" class="dd-item ">
        <a href="../../ch5-debugging/debugging-gdb/">
        <i class='fas fa-vial'></i> 5.2: The Hard Way: GDB
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch6-tasks/" title="6: Task management" class="dd-item
        parent
        
        
        ">
      <a href="../../ch6-tasks/">
          <i class='fab fa-linux'></i> 6: Task management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/processes/" title="6.1: Processes" class="dd-item ">
        <a href="../../ch6-tasks/processes/">
        <i class='fas fa-book'></i> 6.1: Processes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab1_processmgmt/" title="6.2: Processes (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab1_processmgmt/">
        <i class='fas fa-vial'></i> 6.2: Processes (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/interprocess/" title="6.3: Inter Process communication" class="dd-item ">
        <a href="../../ch6-tasks/interprocess/">
        <i class='fas fa-book'></i> 6.3: Inter Process communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/threads/" title="6.4: Threads" class="dd-item ">
        <a href="../../ch6-tasks/threads/">
        <i class='fas fa-book'></i> 6.4: Threads
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab2_threadsmgmt/" title="6.5: Threads (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab2_threadsmgmt/">
        <i class='fas fa-vial'></i>6.5: Threads (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/interthread/" title="6.6: Inter Thread communication" class="dd-item active">
        <a href="../../ch6-tasks/interthread/">
        <i class='fas fa-book'></i> 6.6: Inter Thread communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab3_interthreadcomm/" title="6.7: Inter-Thread communication (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab3_interthreadcomm/">
        <i class='fas fa-vial'></i> 6.7: Inter-Thread communication (lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch7-scheduling/" title="7: CPU scheduling" class="dd-item
        
        
        
        ">
      <a href="../../ch7-scheduling/">
          <i class='fab fa-linux'></i> 7: CPU scheduling
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/algorithms/" title="7.1: Scheduling algorithms" class="dd-item ">
        <a href="../../ch7-scheduling/algorithms/">
        <i class='fas fa-book'></i> 7.1: Scheduling algorithms
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab1_algorithms/" title="7.2: Scheduling algorithms (lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab1_algorithms/">
        <i class='fas fa-vial'></i> 7.2: Scheduling algorithms (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/towards/" title="7.3: Towards real-world schedulers" class="dd-item ">
        <a href="../../ch7-scheduling/towards/">
        <i class='fas fa-book'></i> 7.3: Towards real-world schedulers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab2_niceguy/" title="7.4: Mr. nice guy(lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab2_niceguy/">
        <i class='fas fa-vial'></i> 7.4: Mr. nice guy(lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch8-stack/" title="8: The Stack &amp; The Heap" class="dd-item
        
        
        
        ">
      <a href="../../ch8-stack/">
          <i class='far fa-keyboard'></i> 8: The Stack &amp; The Heap
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/stackvsheap/" title="8.1: The Stack &amp; the Heap" class="dd-item ">
        <a href="../../ch8-stack/stackvsheap/">
        <i class='fas fa-book'></i> 8.1: The Stack &amp; the Heap
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/inspection-labs/" title="8.2: Inspecting memory regions" class="dd-item ">
        <a href="../../ch8-stack/inspection-labs/">
        <i class='fas fa-vial'></i> 8.2: Inspecting memory regions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/scope/" title="8.3: Different Scopes in C" class="dd-item ">
        <a href="../../ch8-stack/scope/">
        <i class='fas fa-book'></i> 8.3: Different Scopes in C
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch9-memory/" title="9: Memory Management" class="dd-item
        
        
        
        ">
      <a href="../../ch9-memory/">
          <i class='fab fa-linux'></i> 9: Memory Management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/memory/" title="9.1: Memory management" class="dd-item ">
        <a href="../../ch9-memory/memory/">
        <i class='fas fa-book'></i> 9.1: Memory management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab1_segfault/" title="9.2: Deliberate Segfaulting" class="dd-item ">
        <a href="../../ch9-memory/lab1_segfault/">
        <i class='fas fa-vial'></i> 9.2: Deliberate Segfaulting
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/paging/" title="9.3: Paging" class="dd-item ">
        <a href="../../ch9-memory/paging/">
        <i class='fas fa-book'></i> 9.3: Paging
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab2_browsing/" title="9.4: Simply browsing through pages" class="dd-item ">
        <a href="../../ch9-memory/lab2_browsing/">
        <i class='fas fa-vial'></i> 9.4: Simply browsing through pages
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/chx-cs/" title="X: Capita Selecta" class="dd-item
        
        
        
        ">
      <a href="../../chx-cs/">
          <i class='fab fa-linux'></i> X: Capita Selecta
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/rtos/" title="X.2: Real-time Operating Systems" class="dd-item ">
        <a href="../../chx-cs/rtos/">
        <i class='fab fa-linux'></i> X.2: Real-time Operating Systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/devdrivers/" title="X.3: Device Drivers" class="dd-item ">
        <a href="../../chx-cs/devdrivers/">
        <i class='fab fa-linux'></i> X.3: Device Drivers
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/exercises/" title="A. Assignments" class="dd-item
        
        
        
        ">
      <a href="../../exercises/">
          <i class='fas fa-pencil-alt'></i> A. Assignments
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/exercises/c-integrated-ex/" title="1. Integrated C exercise" class="dd-item ">
        <a href="../../exercises/c-integrated-ex/">
        <i class='fas fa-pen-square'></i> 1. Integrated C exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/c-debugging-testing/" title="2. Testing in C(&#43;&#43;)" class="dd-item ">
        <a href="../../exercises/c-debugging-testing/">
        <i class='fas fa-pen-square'></i> 2. Testing in C(&#43;&#43;)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/none-yet/" title="None yet!" class="dd-item ">
        <a href="../../exercises/none-yet/">
        <i class='fas fa-pen-square'></i> None yet!
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/appendix/" title="B. Appendix" class="dd-item
        
        
        
        ">
      <a href="../../appendix/">
          <i class='fab fa-github'></i> B. Appendix
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/appendix/reading/" title="1. Recommended reading" class="dd-item ">
        <a href="../../appendix/reading/">
        1. Recommended reading
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/installing/" title="2. Linux Installation Instructions" class="dd-item ">
        <a href="../../appendix/installing/">
        2. Linux Installation Instructions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/cheat_sheet/" title="Cheat sheet" class="dd-item ">
        <a href="../../appendix/cheat_sheet/">
        Cheat sheet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://uhintra03.uhasselt.be/studiegidswww/opleidingsonderdeel.aspx?a=2019&amp;i=4082&amp;n=4&amp;t=01"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://kuleuven-diepenbeek.github.io/osc-course/TODO"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Operating Systems and C</a> > <a href='../../ch6-tasks/'>6: Task management</a> > 6.6: Inter Thread communication
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#critical-section-and-race-conditions">Critical Section and Race Conditions</a></li>
    <li><a href="#atomic-operations">Atomic operations</a></li>
    <li><a href="#mutexes-and-locking">Mutexes and Locking</a>
      <ul>
        <li><a href="#deadlocks">Deadlocks</a></li>
      </ul>
    </li>
    <li><a href="#semaphores">Semaphores</a>
      <ul>
        <li><a href="#producer-consumer-problems">Producer-Consumer Problems</a></li>
        <li><a href="#semaphore-concepts">Semaphore concepts</a></li>
        <li><a href="#semaphores-in-c-and-pthreads">Semaphores in C and pthreads</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              6.6: Inter Thread communication
            </h1>
          

        


<p>One <em>raison d&rsquo;être</em> for multi-threaded applications is <strong>resource sharing</strong>. In the example that was given <a href="../../ch6-tasks/threads/#pthreads">earlier</a> a <strong>global variable</strong> &lsquo;counter&rsquo; was used. No measures were taken for securing this approach and we got some unexpected results. The output of the example looks like shown below:</p>
<figure>
    <img src="../../img/os/sc_631.png"/> 
</figure>
<p>This probably came as a surprise 😃 <br/>
It should be clear that what we wanted to see was <em>Job 1 started</em> followed by <em>Job 1 finished</em> and that this would be repeated again for job number 2.</p>
<p>The first of both threads that gets to its function increments the counter from 0 to 1. However, before this thread has finished its execution, the second thread has started and has incremented the counter from 1 to 2. By the time the first thread finishes, the counter value is 2, which is in contrast with the intended value of 1.</p>
<h2 id="critical-section-and-race-conditions">Critical Section and Race Conditions</h2>
<p>At first glance, it might seem that this problem is easily solvable by copying the global counter to a local, per-thread variable for later use:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#00a8c8">void</span><span style="color:#f92672">*</span> <span style="color:#75af00">doSomeThing</span><span style="color:#111">(</span><span style="color:#00a8c8">void</span> <span style="color:#f92672">*</span><span style="color:#111">arg</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">long</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">local_id</span><span style="color:#111">;</span> <span style="color:#75715e">// new, per-thread variable                                    
</span><span style="color:#75715e"></span>    <span style="color:#111">counter</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
    <span style="color:#111">local_id</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span><span style="color:#111">;</span> <span style="color:#75715e">// make a local copy of counter for this thread                                
</span><span style="color:#75715e"></span>
    <span style="color:#111">printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;  Job %d started</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">,</span> <span style="color:#111">local_id</span><span style="color:#111">);</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#111">i</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">&lt;</span><span style="color:#111">(</span><span style="color:#ae81ff">0xFFFFFFFF</span><span style="color:#111">);</span><span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">);</span>
    <span style="color:#111">printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;  Job %d finished</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">,</span> <span style="color:#111">local_id</span><span style="color:#111">);</span>

    <span style="color:#00a8c8">return</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></div><p>If you tried to implement this, it would probably work&hellip; most of the time at least. As explained in the first section on threads, threads are not necessarily run in parallel all the time, especially not if the number of threads is larger than the number of CPU cores. In fact, there are many situations where given 2 threads, the first one will get some time to execute, is then paused to give the second one some time to execute, unpaused to get some time etc.</p>
<p>As such, if two Threads executing doSomeThing() would be running on a single CPU, the following sequence of actions could occur:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// Code that both threads will execute:
</span><span style="color:#75715e"></span><span style="color:#111">counter</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
<span style="color:#111">local_id</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span><span style="color:#111">;</span>
<span style="color:#75715e">// -----------------------------------
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Thread 1
</span><span style="color:#75715e"></span><span style="color:#111">counter</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#75715e">// after this, counter == 1
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Before Thread 1 can execute local_id = counter, it is paused by the CPU
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Thread 2
</span><span style="color:#75715e"></span>    <span style="color:#111">counter</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#75715e">// after this, counter == 2
</span><span style="color:#75715e"></span>    <span style="color:#111">local_id</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span><span style="color:#111">;</span> <span style="color:#75715e">// thus, in Thread 2, local_id is correctly 2
</span><span style="color:#75715e">// Here, the CPU switches back to Thread 1
</span><span style="color:#75715e">// Thread 1
</span><span style="color:#75715e"></span><span style="color:#111">local_id</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span><span style="color:#111">;</span> <span style="color:#75715e">// now, local_id is still 2, instead of 1... mission failed
</span></code></pre></div><p>We can see that the exact problem we were trying to prevent can still occur, but it depends on how the threads are scheduled by the OS. This is what makes multithreaded programming so difficult in practice: your program can execute without problems 99 times, but still fail the next. These bugs can be very hard to reproduce. They are often called <strong>race conditions</strong>, referring to e.g., a car/horse race where it&rsquo;s not always the same contestant that wins, depending on the conditions of the racetrack. Note that this does not only occur in the case of multiple threads on the same core: similar problems can of course also happen if you have actual parallel threads as well.</p>
<p>In general, we can see that once multiple threads start accessing shared memory, things can go wrong. As such, these specific points in a multithreaded program are often referred to as the <strong>critical section</strong>: it&rsquo;s of the highest importance (critical) that this section is executed by itself, without outside interference. Otherwise, race conditions can occur and we can introduce bugs.</p>
<p>To make this all a bit more tangible, we will be using an outside interactive tool, called <a href="https://deadlockempire.github.io/">Deadlock Empire</a>. Instead of having you write correct code for a problem, this website challenges you to find bugs in existing code to show the many caveats of multithreaded programming. While the website uses the C# programming language and is a bit different from the C syntax we&rsquo;re using, the high-level concepts are 100% the same.</p>

<div class="ex">
	<div class="inner">
    	<p>Go to the Deadlock Empire website and do:</p>
<ul>
<li>Tutorial: Tutorial 1: Interface</li>
<li>Unsynchronized Code: Boolean Flags Are Enough For Everyone</li>
<li>Unsynchronized Code: Simple Counter</li>
</ul>

	</div>
</div>
<h2 id="atomic-operations">Atomic operations</h2>
<p>Now that you have a feeling for race conditions and critical sections, it&rsquo;s time to make things worse.</p>
<p>The example above isn&rsquo;t only vulnerable through the &ldquo;local_id = counter&rdquo; code: the &ldquo;counter += 1&rdquo; code is also vulnerable to a race condition. This is because incrementing a variable (counter += 1) is not a so-called <strong>atomic operation</strong>. This means that internally, it is not implemented with a single CPU instruction, but rather composed out of a series of different operations/instructions.</p>
<p>For example, for counter += 1, the series of executed steps might look like this:</p>
<ol>
<li>Fetch value of counter from RAM and store it in the CPU cache memory</li>
<li>Fetch value from CPU cache memory and store it in a CPU register for the calculation</li>
<li>Add 1 to the register value</li>
<li>Write the register value back to the CPU cache</li>
<li>Write the cached value back to the RAM</li>
</ol>
<p>Put differently: the CPU does not act on the value stored in memory directly, but rather a copy in a register. Copying from/to a register is not atomic, so bugs can occur. To make things simpler to reason about, we can boil this down to just two lines of code:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// In simple pseudocode, counter += 1 might look like this:
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">temp</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#75715e">// temp is for example the CPU register here, and &#34;counter&#34; is the value in memory
</span><span style="color:#75715e"></span><span style="color:#111">counter</span> <span style="color:#f92672">=</span> <span style="color:#111">temp</span><span style="color:#111">;</span> <span style="color:#75715e">// the register value is written back out to the memory
</span></code></pre></div><p>To the CPU, all of these steps are one or more instructions, each of which can also have a certain delay associated with them. As such, what can happen in practice is the following sequence of events:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// Code that both threads will execute:
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">temp</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
<span style="color:#111">counter</span> <span style="color:#f92672">=</span> <span style="color:#111">temp</span><span style="color:#111">;</span>
<span style="color:#75715e">// -----------------------------------
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Thread 1
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">temp</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#75715e">// after this, Thread 1&#39;s temp register contains the value 1. The &#34;counter&#34; value in RAM is still 0.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Before Thread 1 can actually store this temporary register result in memory, the CPU gives control to Thread 2
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Thread 2
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">int</span> <span style="color:#111">temp</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#75715e">// &#34;counter&#34; was still 0 in RAM, so Thread 2&#39;s temp register now also contains the value 1
</span><span style="color:#75715e"></span>    <span style="color:#111">counter</span> <span style="color:#f92672">=</span> <span style="color:#111">temp</span><span style="color:#111">;</span> <span style="color:#75715e">// The &#34;counter&#34; value in RAM is now 1
</span><span style="color:#75715e">// Here, the CPU switches back to Thread 1
</span><span style="color:#75715e">// Thread 1
</span><span style="color:#75715e"></span><span style="color:#111">counter</span> <span style="color:#f92672">=</span> <span style="color:#111">temp</span><span style="color:#111">;</span> <span style="color:#75715e">// The &#34;counter&#34; value in RAM is still 1
</span></code></pre></div><p>We can see that, even though two &ldquo;counter += 1&rdquo; lines of code were executed, the resulting value in memory is just 1 instead of 2. Again: you probably never saw this when testing the exercise in the lab, but theoretically it -could- happen, leading to randomly failing programmes.</p>
<p>Note that this is a direct consequence of the fact that threads have separate program counters and register values, as discussed in the first Section on threads. Once individual threads are started, even if they are executing the same code, they do so in a partially separated context.</p>

<div class="ex">
	<div class="inner">
    	<p>Go to the Deadlock Empire website and do:</p>
<ul>
<li>Tutorial: Tutorial 2: Non-Atomic Instructions</li>
<li>Unsynchronized Code: Confused Counter</li>
</ul>

	</div>
</div>
<p>You might now think that this can only happen if two threads execute the <em>exact same code</em>. However, you would be wrong, as illustrated by the following example from Wikipedia:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// Thread 1
</span><span style="color:#75715e">// ... other code
</span><span style="color:#75715e"></span><span style="color:#111">b</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span><span style="color:#111">;</span>
<span style="color:#75715e">// ... other code
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// Thread 2
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ... other code
</span><span style="color:#75715e"></span>    <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> <span style="color:#111">z</span><span style="color:#111">;</span>
    <span style="color:#75715e">// ... other code
</span></code></pre></div>
<div class="ex">
	<div class="inner">
    	<p>Give a practical, numerical example of how, depending on CPU scheduling, b can end up with two very different values.</p>

	</div>
</div>
<h2 id="mutexes-and-locking">Mutexes and Locking</h2>
<p>As we&rsquo;ve seen in many examples, things can go wrong really quickly when dealing with shared memory. Making matters worse, simple solutions (such as making thread-local copies of shared memory) are also doomed to fail eventually.</p>
<p>As such, it should be clear that we need a way to secure the <strong>critical sections</strong> in a thread. We need a way to make sure the OS will not pause a thread during a critical section, to make sure that all instructions are done before another thread gets execution time. Put differently: we need a way to turn groups of non-atomic operations into a single big atomic block.</p>
<p>The simplest way of doing this, is by means of a <strong>mutex</strong>. This term is a portmanteau of <strong>Mut</strong>ual <strong>Ex</strong>clusion. The behaviour can be seen as the lock on a toilet door. If you are using the toilet, you <strong>lock</strong> the door. Others that want to occupy the toilet have to wait until you&rsquo;re finished and you <strong>unlock</strong> the door (and get out, after washing your hands). Hence, the mutex has only two states: one or zero, on or off, locked or unlocked.</p>
<p>Internally, a mutex lock is typically implemented by means of a single, atomic CPU instruction. Otherwise, simply locking or unlocking the mutex would of course potentially lead to the problems it is trying to solve!</p>
<p>The concept of a mutex is implemented in the pthreads library as a new variable type: <strong>pthread_mutex_t</strong>. Locking and unlocking can be done through functions <strong>pthread_mutex_lock()</strong> and <strong>pthread_mutex_unlock()</strong>. As always, read the documentation for the exact usage of these functions.</p>
<p>The problematic example of the shared counter can be rewritten using a mutex:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#00a8c8">int</span> <span style="color:#111">counter</span><span style="color:#111">;</span>
<span style="color:#111">pthread_mutex_t</span> <span style="color:#111">counter_lock</span><span style="color:#111">;</span>                   <span style="color:#75715e">/* THIS LINE HAS BEEN ADDED */</span>

<span style="color:#00a8c8">void</span><span style="color:#f92672">*</span> <span style="color:#75af00">doSomeThing</span><span style="color:#111">(</span><span style="color:#00a8c8">void</span> <span style="color:#f92672">*</span><span style="color:#111">arg</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">unsigned</span> <span style="color:#00a8c8">long</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">local_id</span><span style="color:#111">;</span>                               <span style="color:#75715e">/* THIS LINE HAS BEEN ADDED */</span>
    <span style="color:#111">pthread_mutex_lock</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">counter_lock</span><span style="color:#111">);</span>          <span style="color:#75715e">/* THIS LINE HAS BEEN ADDED */</span>
    <span style="color:#111">counter</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
    <span style="color:#111">local_id</span> <span style="color:#f92672">=</span> <span style="color:#111">counter</span><span style="color:#111">;</span>                         <span style="color:#75715e">/* THIS LINE HAS BEEN ADDED */</span>
    <span style="color:#111">pthread_mutex_unlock</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">counter_lock</span><span style="color:#111">);</span>        <span style="color:#75715e">/* THIS LINE HAS BEEN ADDED */</span>


    <span style="color:#111">printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;  Job %d started</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">,</span> <span style="color:#111">local_id</span><span style="color:#111">);</span>     <span style="color:#75715e">/* THIS LINE HAS BEEN CHANGED */</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#111">i</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">&lt;</span><span style="color:#111">(</span><span style="color:#ae81ff">0xFFFFFFFF</span><span style="color:#111">);</span><span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">);</span>
    <span style="color:#111">printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;  Job %d finished</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">,</span> <span style="color:#111">local_id</span><span style="color:#111">);</span>    <span style="color:#75715e">/* THIS LINE HAS BEEN CHANGED */</span>

    <span style="color:#00a8c8">return</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></div><p>This solves the issue that was encountered above. Before the counter is accessed, the mutex is locked. This provides exclusive access to the following 2-line critical section untill the mutex is unlocked again. The counter is then incremented and copied in to variable <em>local_id</em>. Finally, the mutex is unlocked.</p>
<p>With this measure in place, the result is as was originally intended.</p>
<figure>
    <img src="../../img/os/sc_mutex.png"/> 
</figure>
<p><strong>Note:</strong> The amount of code/instructions between locking and unlocking a mutex should of course be kept to a minimum. If you put a mutex around your entire threading function, you undo the entire possible benefit of using threads: the fact that they can run in parallel! As such, inter-thread communication via shared memory should be kept to a minimum, and only that should be protected using Mutexes/locks.</p>

<div class="ex">
	<div class="inner">
    	<p>Go to the Deadlock Empire website and do:</p>
<ul>
<li>Locks: Insufficient lock</li>
<li>Locks: Deadlock</li>
</ul>

	</div>
</div>
<h3 id="deadlocks">Deadlocks</h3>
<p>While locks help with many <strong>critical section</strong> problems, the Deadlock Empire examples above show that they are also not always trivial to apply correctly. This is especially the case if there is more than one shared resource/variable/memory region in play.</p>
<p>For example, a typical problem that can arise is when two threads need to obtain access to two different shared resources, but do so in opposite orders. This can for example happen in complex programs that often interact with outside peripherals like the hard disk and the network:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// Thread 1 wants to first read from the network, then write result to the hard disk
</span><span style="color:#75715e">// Thread 2 wants to first read the contents of a file, then send it on the network
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Thread 1:
</span><span style="color:#75715e"></span><span style="color:#111">network</span><span style="color:#111">.</span><span style="color:#111">lock</span><span style="color:#111">()</span>
    <span style="color:#75715e">// CPU pauses Thread 1 and activates Thread 2
</span><span style="color:#75715e"></span>    <span style="color:#111">harddisk</span><span style="color:#111">.</span><span style="color:#111">lock</span><span style="color:#111">()</span>
<span style="color:#75715e">// CPU pauses Thread 2 and activates Thread 1 again
</span><span style="color:#75715e"></span><span style="color:#111">harddisk</span><span style="color:#111">.</span><span style="color:#111">lock</span><span style="color:#111">()</span> <span style="color:#75715e">// this will not complete, because Thread 2 is holding this lock already. Thread 1 has to wait
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// CPU pauses Thread 1 because it has to wait and activates Thread 2 again
</span><span style="color:#75715e"></span>    <span style="color:#111">network</span><span style="color:#111">.</span><span style="color:#111">lock</span><span style="color:#111">()</span> <span style="color:#75715e">// this will not complete, because Thread 1 is holding this lock already. Thread 2 has to wait
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Both threads are waiting endlessly AND also locking the network and the harddisk for any other threads that might arrive
</span></code></pre></div><p>Note: this example is not entirely realistic, as the network and harddisk can generally be used by multiple threads and processes concurrently. This is because the OS (or even the hardware itself) has layers of abstraction, but also complex ways of detecting and preventing deadlocks from happening (for extra information, see <a href="http://lass.cs.umass.edu/~shenoy/courses/fall15/lectures/Lec11.pdf">this presentation</a> (this is not course material)). Still, you can pretty easily make this mistake in your own program when accessing multiple pieces of shared memory, so watch out!</p>
<h2 id="semaphores">Semaphores</h2>
<p>While mutex locks are useful, the are also relatively simple and limited in what they can convey. As such, over time more advanced thread synchronization techniques have evolved that make it a bit easier to deal with often occurring scenarios. One such more advanced technique is a <strong>semaphore</strong>. A semaphore makes it easier to track how many threads are requesting access or have already been given access to a particular resource.</p>
<h3 id="producer-consumer-problems">Producer-Consumer Problems</h3>
<p>This technique is used in for example producer-consumer problems. There, one or more producer threads prepare data (in our exercises: prime numbers) and put it in a limited amount of shared memory spots (say an array of size 10), ready to be used by one or more consumers (in our exercises: a function that prints the prime numbers). This type of setup prevents us from having to allocate a large amount of memory up-front to communicate thread results (as we did in the solution to the last exercise in the previous lab).</p>
<figure>
    <img src="../../img/Multi-Producers-Multi-Consumers.jpg"/> <figcaption>
            <h4>A high-level visualization of a multi-producer &#43; multi-consumer problem with a limited amount of shared memory in between.</h4>
        </figcaption>
</figure>
<p>In this setup, we don&rsquo;t just want to lock access to the shared memory so only 1 producer or consumer can use it at a given time, we want to do more: we want the producers to only write data to the shared memory if there is an open spot. If not, they have to wait. Similarly, the consumers can only read data from shared memory if there is actually something there. If not, they have to wait.</p>
<p>Conceptually, we could do this by keeping track of a count of the amount of items currently in the shared array (<code>items_in_array</code> below), and increment/decrement that count inside a mutex lock when producing/consuming (similar to the global counter solution above):</p>
<div class="multicol">
<div>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// PSEUDOCODE!
</span><span style="color:#75715e"></span><span style="color:#111">mutex</span> <span style="color:#111">myLock</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#111">items_in_array</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> 
<span style="color:#00a8c8">int</span><span style="color:#f92672">*</span> <span style="color:#111">array</span> <span style="color:#f92672">=</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span><span style="color:#111">);</span>

<span style="color:#00a8c8">void</span><span style="color:#f92672">*</span> <span style="color:#75af00">producer</span><span style="color:#111">()</span> 
<span style="color:#111">{</span>
    <span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">true</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span>
        <span style="color:#00a8c8">bool</span> <span style="color:#111">itemStored</span> <span style="color:#f92672">=</span> <span style="color:#111">false</span><span style="color:#111">;</span>
        <span style="color:#111">Item</span> <span style="color:#111">item</span> <span style="color:#f92672">=</span> <span style="color:#111">produceItem</span><span style="color:#111">();</span>

        <span style="color:#00a8c8">while</span><span style="color:#111">(</span> <span style="color:#f92672">!</span><span style="color:#111">itemStored</span> <span style="color:#111">)</span> <span style="color:#111">{</span>

            <span style="color:#111">lock</span><span style="color:#111">(</span> <span style="color:#111">myLock</span> <span style="color:#111">);</span>
            
            <span style="color:#00a8c8">if</span><span style="color:#111">(</span> <span style="color:#111">items_in_array</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span> <span style="color:#111">)</span> <span style="color:#111">{</span>
                <span style="color:#111">array</span><span style="color:#111">[</span> <span style="color:#111">items_in_array</span> <span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">item</span><span style="color:#111">;</span>
                <span style="color:#111">items_in_array</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>

                <span style="color:#111">itemStored</span> <span style="color:#f92672">=</span> <span style="color:#111">true</span><span style="color:#111">;</span>
            <span style="color:#111">}</span>

            <span style="color:#111">unlock</span><span style="color:#111">(</span> <span style="color:#111">myLock</span> <span style="color:#111">);</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></div></div>
<div>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// PSEUDOCODE!
</span><span style="color:#75715e"></span>



<span style="color:#00a8c8">void</span><span style="color:#f92672">*</span> <span style="color:#75af00">consumer</span><span style="color:#111">()</span> 
<span style="color:#111">{</span>
    <span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">true</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span>
        <span style="color:#111">Item</span> <span style="color:#111">item</span> <span style="color:#f92672">=</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>

        <span style="color:#111">lock</span><span style="color:#111">(</span> <span style="color:#111">myLock</span> <span style="color:#111">);</span>
        
        <span style="color:#00a8c8">if</span><span style="color:#111">(</span> <span style="color:#111">items_in_array</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#111">item</span> <span style="color:#f92672">=</span> <span style="color:#111">array</span><span style="color:#111">[</span> <span style="color:#111">items_in_array</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#111">];</span>
            <span style="color:#111">items_in_array</span> <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>

        <span style="color:#111">unlock</span><span style="color:#111">(</span> <span style="color:#111">myLock</span> <span style="color:#111">);</span>

        <span style="color:#00a8c8">if</span><span style="color:#111">(</span> <span style="color:#111">item</span> <span style="color:#f92672">!=</span> <span style="color:#111">NULL</span> <span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#111">consumeItem</span><span style="color:#111">(</span><span style="color:#111">item</span><span style="color:#111">);</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></div></div>
</div>
<p>This setup will work, however it is <strong>very inefficient</strong>: both the producers and the consumers are constantly trying to get a new lock on the array to check if they can produce/consume something, even if it&rsquo;s only been a few milliseconds since they last checked (and found the array was full/empty and there was nothing to do). Imagine for example if the producers in the example are slow to produce new items, but the consumers are very fast: the consumers would constantly be re-locking the mutex to check if something new is available, even though there rarely is, causing the mutex to be almost immediately unlocked again. This type of behaviour is often called <strong>busy waiting</strong> or <strong>polling</strong> and is bad for performance as you&rsquo;re doing a lot of unnecessary work.</p>
<p>Instead, a better solution would be that a thread that wants to read/write an item from/to the array can only do so if it is actually possible. If not, the thread should be <strong>paused</strong> until it&rsquo;s sure that it can make progress, instead of constantly checking. To do this, we need a new type of lock that keeps track of who&rsquo;s waiting for what to happen, which is called <strong>the semaphore</strong>.</p>
<h3 id="semaphore-concepts">Semaphore concepts</h3>
<p>In essence, the semaphore is nothing more than a counter (the <code>items_in_array</code> from above), but one that can <strong>automatically pause/resume threads that use</strong> it if the counter is zero/becomes positive (while above, we had to do this manually).</p>
<p>This is typically done using three conceptual functions on the semaphore:</p>
<ul>
<li><code>init( mySemaphore, count )</code> : Start the semaphore value at <code>count</code> (can be either 0 or a positive number).</li>
<li><code>wait( mySemaphore )</code> : Continues if mySemaphore is &gt; 0 and decrements it by 1. If not, it pauses the current thread until mySemaphore becomes positive.</li>
<li><code>post( mySemaphore )</code> : Increments mySemaphore by 1. This then automatically causes <strong>1 of the waiting threads</strong> (if any) to be unpaused.</li>
</ul>

<div class="notices note" ><p>As you can see, multiple threads can be waiting on the same semaphore (determined by the <code>count</code> passed in <code>init()</code>). For each time a <code>post()</code> is done however, only 1 of the waiting threads can of course be unpaused. The OS determines which thread is chosen from among the waiters and can do so in many different ways (for example thread that has been paused the longest, thread that has been paused the shortest, thread that was most recently started, the thread with the highest priority, etc.). More information on this is given in Chapter 7 (Scheduling).</p>
</div>

<p>To illustrate this, a semaphore can be thought of as a bowl with tokens. For example, in a child daycare there can be a room with toys:</p>
<figure>
    <img src="../../img/cafe-boulevard.jpg" width="50%"/> <figcaption>
            <h4>A photo of Cafe Boulevard (courtesy of Tripadvisor)</h4>
        </figcaption>
</figure>
<p>Only 5 children are allowed in that room. Outside, there is a bowl with bracelets (<code>init( braceletBowl, 5 )</code>). When a child wants to enter the room to play, they need to take a bracelet and put it on (<code>wait( braceletBowl )</code>). When there are no more bracelets in the bowl, a child that also wants to play in the room has to wait (also <code>wait( braceletBowl )</code>) until another child leaves the room and places their bracelet back in the bowl (<code>post( braceletBowl )</code>).</p>
<p>Using semaphores then, we can more optimally re-write the producer-consumer setup from above. Note however that we <strong>can&rsquo;t just use a single semaphore</strong>, since the wait/post functions really only allow us to wait if the value is 0, not if the value is for example 10 (the maximum size of the array). As such, we need two: one to indicate how much slots are filled, and one to indicate how many are empty:</p>
<div class="multicol">
<div>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// PSEUDOCODE!
</span><span style="color:#75715e"></span><span style="color:#111">mutex</span> <span style="color:#111">myLock</span><span style="color:#111">;</span>

<span style="color:#111">semaphore</span> <span style="color:#111">fill_count</span><span style="color:#111">;</span>  
<span style="color:#111">init</span><span style="color:#111">(</span><span style="color:#111">fill_count</span><span style="color:#111">,</span>  <span style="color:#ae81ff">0</span><span style="color:#111">);</span>

<span style="color:#111">semaphore</span> <span style="color:#111">empty_count</span><span style="color:#111">;</span> 
<span style="color:#111">init</span><span style="color:#111">(</span><span style="color:#111">empty_count</span><span style="color:#111">,</span> <span style="color:#ae81ff">10</span><span style="color:#111">);</span>

<span style="color:#00a8c8">int</span> <span style="color:#111">items_in_array</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> 
<span style="color:#00a8c8">int</span><span style="color:#f92672">*</span> <span style="color:#111">array</span> <span style="color:#f92672">=</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span><span style="color:#111">);</span>

<span style="color:#00a8c8">void</span><span style="color:#f92672">*</span> <span style="color:#75af00">producer</span><span style="color:#111">()</span> 
<span style="color:#111">{</span>
    <span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">true</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span>
        <span style="color:#111">Item</span> <span style="color:#111">item</span> <span style="color:#f92672">=</span> <span style="color:#111">produceItem</span><span style="color:#111">();</span>

        <span style="color:#111">wait</span><span style="color:#111">(</span> <span style="color:#111">empty_count</span> <span style="color:#111">);</span> <span style="color:#75715e">// THIS IS NEW!
</span><span style="color:#75715e"></span>
        <span style="color:#111">lock</span><span style="color:#111">(</span> <span style="color:#111">myLock</span> <span style="color:#111">);</span>
        
        <span style="color:#111">array</span><span style="color:#111">[</span> <span style="color:#111">items_in_array</span> <span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">item</span><span style="color:#111">;</span>
        <span style="color:#111">items_in_array</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>

        <span style="color:#111">unlock</span><span style="color:#111">(</span> <span style="color:#111">myLock</span> <span style="color:#111">);</span>
        
        <span style="color:#111">post</span><span style="color:#111">(</span> <span style="color:#111">fill_count</span> <span style="color:#111">);</span> <span style="color:#75715e">// THIS IS NEW!
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></div></div>
<div>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">// PSEUDOCODE!
</span><span style="color:#75715e"></span>

  


 





<span style="color:#00a8c8">void</span><span style="color:#f92672">*</span> <span style="color:#75af00">consumer</span><span style="color:#111">()</span> 
<span style="color:#111">{</span>
    <span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">true</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span>
        <span style="color:#111">Item</span> <span style="color:#111">item</span> <span style="color:#f92672">=</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>

        <span style="color:#111">wait</span><span style="color:#111">(</span> <span style="color:#111">fill_count</span> <span style="color:#111">);</span> <span style="color:#75715e">// THIS IS NEW! 
</span><span style="color:#75715e"></span>
        <span style="color:#111">lock</span><span style="color:#111">(</span> <span style="color:#111">myLock</span> <span style="color:#111">);</span>
        
        <span style="color:#111">item</span> <span style="color:#f92672">=</span> <span style="color:#111">array</span><span style="color:#111">[</span> <span style="color:#111">items_in_array</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#111">];</span>
        <span style="color:#111">items_in_array</span> <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>

        <span style="color:#111">unlock</span><span style="color:#111">(</span> <span style="color:#111">myLock</span> <span style="color:#111">);</span>

        <span style="color:#111">post</span><span style="color:#111">(</span> <span style="color:#111">empty_count</span> <span style="color:#111">);</span> <span style="color:#75715e">// THIS IS NEW! 
</span><span style="color:#75715e"></span>
        <span style="color:#111">consumeItem</span><span style="color:#111">(</span><span style="color:#111">item</span><span style="color:#111">);</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></div></div>
</div>

<div class="ex">
	<div class="inner">
    	<p>It might seem strange to you that when using semaphores, we still ALSO need a mutex when actually writing to/reading from the shared array. Can you explain why this is needed? Can you explain why we&rsquo;re using semaphores in the first place then, if they don&rsquo;t even allow us to remove the mutex?</p>
<div class="solution" style="display: block;"  id="q661">
  <b>Answer:</b><br/>
  <p>
    When using a Semaphore with an initial value higher than 1, multiple threads can still "enter" the semaphore at the same time (this is exactly one of the reasons to use a semaphore after all!). The amount of simultaneous threads is just limited by the Semaphore value. 
  </p>
  <p>
    As such, we still need to protect the critical section inside the semaphore block if it accesses shared memory, or we would again have race conditions!
  </p>
  <p>
    We see that using semaphores is indeed not done to remove the mutex, but rather to remove the busy waiting while() loop and the custom checks if the array is full/empty. Compare the semaphore version with the pure-mutex version and you'll see we were able to actually get rid of quite some code + we're no longer constantly locking/unlocking the mutex!
  </p>
</div>
<input value="Toggle solution" type="button" onclick="toggleDisplay('q661')"/>

	</div>
</div>

<div class="notices bignote" ><p>Note that, if we initialize the Semaphore with a value of 1 (<code>init( mySemaphore, 1 )</code>), we basically get a mutex! After all, only a single thread can be active inside the semaphore at any given time then, leading to the same behaviour as a mutex. This is then typically referred to as a <strong>binary semaphore</strong>.</p>
<p>In this setup, we of course <em>don&rsquo;t</em> need another mutex inside the semaphore block, since we&rsquo;re already getting that guarantee from the binary semaphore.</p>
<p>This is sometimes used if the size of the shared memory is just a single item, often referred to as a &ldquo;shelf&rdquo; (see also later exercises and the threading assignment), to prevent having to keep a manual counter variable alongside a mutex (the binary semaphore is mutex and counter all-in-one!).</p>
<p>More info on the differences between a semaphore and a mutex are given <a href="https://techdifferences.com/difference-between-semaphore-and-mutex.html">here</a>.</p>
</div>


<div class="ex">
	<div class="inner">
    	<p>Go to the Deadlock Empire website and do:</p>
<ul>
<li>Semaphores: Semaphores</li>
<li>Semaphores: Producer-Consumer</li>
<li>Semaphores: Producer-Consumer (Variant)</li>
</ul>

	</div>
</div>
<h3 id="semaphores-in-c-and-pthreads">Semaphores in C and pthreads</h3>
<p>The <strong>pthreads</strong> library provides an API to program with semaphores in C (include semaphore.h to use). It contains the <code>semaphore_t</code> type and, amongst others, these functions (which are the same as discussed previously):</p>
<ul>
<li><code>sem_init()</code>: initialises a semaphore.</li>
<li><code>sem_wait()</code>: waits until the semaphore is positive, then decrements the number inside of the semaphore.</li>
<li><code>sem_post()</code>: increments the number inside of the semaphore and unpauses one of the waiting threads (if any). (note: in other programming languages, this operation is often called <code>signal</code> instead of <code>post</code>)</li>
<li><code>sem_destroy()</code>: destroys the semaphore when it&rsquo;s no longer needed.</li>
</ul>

<div class="notices note" ><p>There is also a &ldquo;non-pausing&rdquo; alternative to sem_wait: <code>sem_trywait()</code>. This variant will only decrement the semaphore if it&rsquo;s positive. If it&rsquo;s zero, it won&rsquo;t pause the current thread. Additionally, this function returns the current value of the semaphore, which allows us to really use it as a replacement for a counter! See the manual pages and search Google for more info and the correct usage of this version!</p>
</div>

<p>Note that next to mutexes and semaphores, there are many other thread synchronization utilities and concepts (such as for example &ldquo;conditional variables&rdquo;, &ldquo;monitors&rdquo; and &ldquo;barriers&rdquo;). Especially more modern programming languages like Java, C#, Rust, and Go typically have highly advanced threading options built-in. Some of these you can (optionally) explore and experiment with using the exercises from Deadlock Empire that we skipped.</p>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../ch6-tasks/lab2_threadsmgmt/" title="6.5: Threads (lab)"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../ch6-tasks/lab3_interthreadcomm/" title="6.7: Inter-Thread communication (lab)" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1679059470"></script>
    <script src="../../js/perfect-scrollbar.min.js?1679059470"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1679059470"></script>
    <script src="../../js/jquery.sticky.js?1679059470"></script>
    <script src="../../js/featherlight.min.js?1679059470"></script>
    <script src="../../js/modernizr.custom-3.6.0.js?1679059470"></script>
    <script src="../../js/learn.js?1679059470"></script>
    <script src="../../js/hugo-learn.js?1679059470"></script>
    
        
            <script src="../../mermaid/mermaid.js?1679059470"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    <script>
    window.MathJax = {
      chtml: {
        scale: 2,                      
        minScale: .5,                  
        matchFontHeight: true,         
        mtextInheritFont: false,       
        merrorInheritFont: true,       
        mathmlSpacing: false,          
        skipAttributes: {},            
        exFactor: .5,                  
        displayAlign: 'center',        
        displayIndent: '0'             
      }
    };
    </script>
    
    

  </body>
</html>

