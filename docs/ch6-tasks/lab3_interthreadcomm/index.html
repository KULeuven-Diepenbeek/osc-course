<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>6.7: Inter-Thread communication (lab) :: Operating Systems and C</title>

    
    <link href="../../css/nucleus.css?1650362829" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1650362829" rel="stylesheet">
    <link href="../../css/hybrid.css?1650362829" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1650362829" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1650362829" rel="stylesheet">
    <link href="../../css/auto-complete.css?1650362829" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1650362829" rel="stylesheet">
    <link href="../../css/theme.css?1650362829" rel="stylesheet">
    <link href="../../css/devselector.css?1650362829" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1650362829" rel="stylesheet">
    <link href="../../css/theme-kul.css?1650362829" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1650362829"></script>
    <script src="../../js/devselector.js?1650362829"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    <script src="../../js/osc.js"></script>

  </head>
  <body class="" data-url="../../ch6-tasks/lab3_interthreadcomm/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../images/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../images/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1650362829"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1650362829"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/kuleuven-diepenbeek.github.io\/osc-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1650362829"></script>

    
  </div>

    <div class="highlightable">

      <h3><a href="../../">Course Contents</a></h3>
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ch1-introos/" title="1: Intro in OS" class="dd-item
        
        
        
        ">
      <a href="../../ch1-introos/">
          <i class='fab fa-linux'></i> 1: Intro in OS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/intro-os/" title="1.1: Intro to OS using Linux" class="dd-item ">
        <a href="../../ch1-introos/intro-os/">
        <i class='fas fa-book'></i> 1.1: Intro to OS using Linux
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/filesystems/" title="1.2: File systems" class="dd-item ">
        <a href="../../ch1-introos/filesystems/">
        <i class='fab fa-linux'></i> 1.2: File systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/cli/" title="1.3: Getting your CLI-feet wet" class="dd-item ">
        <a href="../../ch1-introos/cli/">
        <i class='fas fa-vial'></i> 1.3: Getting your CLI-feet wet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch2-c/" title="2: Introduction in C" class="dd-item
        
        
        
        ">
      <a href="../../ch2-c/">
          <i class='far fa-keyboard'></i> 2: Introduction in C
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/intro/" title="2.1: The C programming language" class="dd-item ">
        <a href="../../ch2-c/intro/">
        <i class='fas fa-book'></i> 2.1: The C programming language
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/intro-labs/" title="2.2: String Manipulation" class="dd-item ">
        <a href="../../ch2-c/intro-labs/">
        <i class='fas fa-vial'></i> 2.2: String Manipulation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/structs/" title="2.3: Creating order: Structures" class="dd-item ">
        <a href="../../ch2-c/structs/">
        <i class='fas fa-book'></i> 2.3: Creating order: Structures
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/structs-labs/" title="2.4: Structs" class="dd-item ">
        <a href="../../ch2-c/structs-labs/">
        <i class='fas fa-vial'></i> 2.4: Structs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/ecosystems/" title="2.5: C Ecosystems" class="dd-item ">
        <a href="../../ch2-c/ecosystems/">
        <i class='fas fa-book'></i> 2.5: C Ecosystems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/ecosystems-labs/" title="2.6: Splitting up Code" class="dd-item ">
        <a href="../../ch2-c/ecosystems-labs/">
        <i class='fas fa-vial'></i> 2.6: Splitting up Code
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch3-introcpu/" title="3: Introduction in CPU" class="dd-item
        
        
        
        ">
      <a href="../../ch3-introcpu/">
          <i class='fab fa-linux'></i> 3: Introduction in CPU
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/1_vonneumann/" title="3.1 Von Neumann Architecture" class="dd-item ">
        <a href="../../ch3-introcpu/1_vonneumann/">
        <i class='fab fa-linux'></i> 3.1 Von Neumann Architecture
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/1_lab_assembly/" title="3.2: Assembly basics" class="dd-item ">
        <a href="../../ch3-introcpu/1_lab_assembly/">
        <i class='fas fa-vial'></i> 3.2: Assembly basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/2_functions/" title="3.3 Functions and The Stack" class="dd-item ">
        <a href="../../ch3-introcpu/2_functions/">
        <i class='fab fa-linux'></i> 3.3 Functions and The Stack
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/2_lab_stack/" title="3.4: The Stack" class="dd-item ">
        <a href="../../ch3-introcpu/2_lab_stack/">
        <i class='fas fa-vial'></i> 3.4: The Stack
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch4-pointers/" title="4: Pointers &amp; Arrays" class="dd-item
        
        
        
        ">
      <a href="../../ch4-pointers/">
          <i class='far fa-keyboard'></i> 4: Pointers &amp; Arrays
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/pointers/" title="4.1: Pointers and arrays" class="dd-item ">
        <a href="../../ch4-pointers/pointers/">
        <i class='far fa-keyboard'></i> 4.1: Pointers and arrays
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/practical-use/" title="4.2: Practical Use of Pointers" class="dd-item ">
        <a href="../../ch4-pointers/practical-use/">
        <i class='far fa-keyboard'></i> 4.2: Practical Use of Pointers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/lab/" title="4.3: The Ancient Library" class="dd-item ">
        <a href="../../ch4-pointers/lab/">
        <i class='fas fa-vial'></i> 4.3: The Ancient Library
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch5-debugging/" title="5: Debugging" class="dd-item
        
        
        
        ">
      <a href="../../ch5-debugging/">
          <i class='far fa-keyboard'></i> 5: Debugging
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/debugging-ide/" title="5.1: The Easy Way: IDEs" class="dd-item ">
        <a href="../../ch5-debugging/debugging-ide/">
        <i class='far fa-keyboard'></i> 5.1: The Easy Way: IDEs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/testing/" title="5.3: The Middle Way: TDD" class="dd-item ">
        <a href="../../ch5-debugging/testing/">
        <i class='far fa-keyboard'></i> 5.3: The Middle Way: TDD
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/debugging-gdb/" title="5.2: The Hard Way: GDB" class="dd-item ">
        <a href="../../ch5-debugging/debugging-gdb/">
        <i class='fas fa-vial'></i> 5.2: The Hard Way: GDB
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch6-tasks/" title="6: Task management" class="dd-item
        parent
        
        
        ">
      <a href="../../ch6-tasks/">
          <i class='fab fa-linux'></i> 6: Task management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/processes/" title="6.1: Processes" class="dd-item ">
        <a href="../../ch6-tasks/processes/">
        <i class='fas fa-book'></i> 6.1: Processes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab1_processmgmt/" title="6.2: Processes (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab1_processmgmt/">
        <i class='fas fa-vial'></i> 6.2: Processes (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/interprocess/" title="6.3: Inter Process communication" class="dd-item ">
        <a href="../../ch6-tasks/interprocess/">
        <i class='fas fa-book'></i> 6.3: Inter Process communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/threads/" title="6.4: Threads" class="dd-item ">
        <a href="../../ch6-tasks/threads/">
        <i class='fas fa-book'></i> 6.4: Threads
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab2_threadsmgmt/" title="6.5: Threads (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab2_threadsmgmt/">
        <i class='fas fa-vial'></i>6.5: Threads (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/interthread/" title="6.6: Inter Thread communication" class="dd-item ">
        <a href="../../ch6-tasks/interthread/">
        <i class='fas fa-book'></i> 6.6: Inter Thread communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab3_interthreadcomm/" title="6.7: Inter-Thread communication (lab)" class="dd-item active">
        <a href="../../ch6-tasks/lab3_interthreadcomm/">
        <i class='fas fa-vial'></i> 6.7: Inter-Thread communication (lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch7-scheduling/" title="7: CPU scheduling" class="dd-item
        
        
        
        ">
      <a href="../../ch7-scheduling/">
          <i class='fab fa-linux'></i> 7: CPU scheduling
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/algorithms/" title="7.1: Scheduling algorithms" class="dd-item ">
        <a href="../../ch7-scheduling/algorithms/">
        <i class='fas fa-book'></i> 7.1: Scheduling algorithms
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab1_algorithms/" title="7.2: Scheduling algorithms (lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab1_algorithms/">
        <i class='fas fa-vial'></i> 7.2: Scheduling algorithms (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/towards/" title="7.3: Towards real-world schedulers" class="dd-item ">
        <a href="../../ch7-scheduling/towards/">
        <i class='fas fa-book'></i> 7.3: Towards real-world schedulers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab2_niceguy/" title="7.4: Mr. nice guy(lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab2_niceguy/">
        <i class='fas fa-vial'></i> 7.4: Mr. nice guy(lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch8-stack/" title="8: The Stack &amp; The Heap" class="dd-item
        
        
        
        ">
      <a href="../../ch8-stack/">
          <i class='far fa-keyboard'></i> 8: The Stack &amp; The Heap
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/stackvsheap/" title="8.1: The Stack &amp; the Heap" class="dd-item ">
        <a href="../../ch8-stack/stackvsheap/">
        <i class='fas fa-book'></i> 8.1: The Stack &amp; the Heap
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/inspection-labs/" title="8.2: Inspecting memory regions" class="dd-item ">
        <a href="../../ch8-stack/inspection-labs/">
        <i class='fas fa-vial'></i> 8.2: Inspecting memory regions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/scope/" title="8.3: Different Scopes in C" class="dd-item ">
        <a href="../../ch8-stack/scope/">
        <i class='fas fa-book'></i> 8.3: Different Scopes in C
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch9-memory/" title="9: Memory Management" class="dd-item
        
        
        
        ">
      <a href="../../ch9-memory/">
          <i class='fab fa-linux'></i> 9: Memory Management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/memory/" title="9.1: Memory management" class="dd-item ">
        <a href="../../ch9-memory/memory/">
        <i class='fas fa-book'></i> 9.1: Memory management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab1_segfault/" title="9.2: Deliberate Segfaulting" class="dd-item ">
        <a href="../../ch9-memory/lab1_segfault/">
        <i class='fas fa-vial'></i> 9.2: Deliberate Segfaulting
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/paging/" title="9.3: Paging" class="dd-item ">
        <a href="../../ch9-memory/paging/">
        <i class='fas fa-book'></i> 9.3: Paging
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab2_browsing/" title="9.4: Simply browsing through pages" class="dd-item ">
        <a href="../../ch9-memory/lab2_browsing/">
        <i class='fas fa-vial'></i> 9.4: Simply browsing through pages
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/chx-cs/" title="X: Capita Selecta" class="dd-item
        
        
        
        ">
      <a href="../../chx-cs/">
          <i class='fab fa-linux'></i> X: Capita Selecta
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/rtos/" title="X.2: Real-time Operating Systems" class="dd-item ">
        <a href="../../chx-cs/rtos/">
        <i class='fab fa-linux'></i> X.2: Real-time Operating Systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/devdrivers/" title="X.3: Device Drivers" class="dd-item ">
        <a href="../../chx-cs/devdrivers/">
        <i class='fab fa-linux'></i> X.3: Device Drivers
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/exercises/" title="A. Assignments" class="dd-item
        
        
        
        ">
      <a href="../../exercises/">
          <i class='fas fa-pencil-alt'></i> A. Assignments
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/exercises/c-integrated-ex/" title="1. Integrated C exercise" class="dd-item ">
        <a href="../../exercises/c-integrated-ex/">
        <i class='fas fa-pen-square'></i> 1. Integrated C exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/c-debugging-testing/" title="2. Testing in C(&#43;&#43;)" class="dd-item ">
        <a href="../../exercises/c-debugging-testing/">
        <i class='fas fa-pen-square'></i> 2. Testing in C(&#43;&#43;)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/tasks_inter_thread_communication/" title="3. Inter-thread communication" class="dd-item ">
        <a href="../../exercises/tasks_inter_thread_communication/">
        <i class='fas fa-pen-square'></i> 3. Inter-thread communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/scheduler/" title="4. Pseudo scheduler" class="dd-item ">
        <a href="../../exercises/scheduler/">
        <i class='fas fa-pen-square'></i> 4. Pseudo scheduler
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/appendix/" title="B. Appendix" class="dd-item
        
        
        
        ">
      <a href="../../appendix/">
          <i class='fab fa-github'></i> B. Appendix
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/appendix/lab_ll_rtos/" title="3.3: The Ancient Library (RTOS)" class="dd-item ">
        <a href="../../appendix/lab_ll_rtos/">
        <i class='fas fa-vial'></i> 3.3: The Ancient Library (RTOS)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/reading/" title="1. Recommended reading" class="dd-item ">
        <a href="../../appendix/reading/">
        1. Recommended reading
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/installing/" title="2. Linux Installation Instructions" class="dd-item ">
        <a href="../../appendix/installing/">
        2. Linux Installation Instructions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/cheat_sheet/" title="Cheat sheet" class="dd-item ">
        <a href="../../appendix/cheat_sheet/">
        Cheat sheet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://uhintra03.uhasselt.be/studiegidswww/opleidingsonderdeel.aspx?a=2019&amp;i=4082&amp;n=4&amp;t=01"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://kuleuven-diepenbeek.github.io/osc-course/TODO"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Operating Systems and C</a> > <a href='../../ch6-tasks/'>6: Task management</a> > 6.7: Inter-Thread communication (lab)
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#good-morning-sire">Good Morning, Sire</a>
      <ul>
        <li><a href="#polite-servants-impolite-king">Polite servants, impolite king</a></li>
        <li><a href="#polite-king">Polite king</a></li>
      </ul>
    </li>
    <li><a href="#deadlock-empire-the-endgame">Deadlock Empire: The Endgame</a></li>
    <li><a href="#producer-consumer-v1--single-mutex">Producer-Consumer V1 : Single mutex</a></li>
    <li><a href="#producer-consumer-v2--proper-close">Producer-Consumer V2 : Proper close</a></li>
    <li><a href="#producer-consumer-v3--multiple-consumers">Producer-Consumer V3 : Multiple consumers</a></li>
    <li><a href="#producer-consumer-v4--semaphores">Producer-Consumer V4 : Semaphores</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              6.7: Inter-Thread communication (lab)
            </h1>
          

        


<figure>
    <img src="../../img/os/header_communication.jpg"/> <figcaption>
            <h4>Source: G.I.</h4>
        </figcaption>
</figure>

<h2 id="good-morning-sire">Good Morning, Sire</h2>
<h3 id="polite-servants-impolite-king">Polite servants, impolite king</h3>
<p>Extend <a href="../../exercises/ch6-hello-sire-template.cpp">this incomplete C-program</a>. As you can see, the program has <strong>one</strong> <em>king</em> thread and <strong>N</strong> <em>servant</em> threads, but they don&rsquo;t really do anything yet. Implement the following using <strong>one or more semaphores</strong>:</p>
<ul>
<li>The king thread sleeps (using the <code>sleep()</code> function) for a random amount of time (a few seconds).</li>
<li>When the king thread awakes, it signals the servant threads.</li>
<li>All servant threads politely say <strong>Good Morning, sire</strong> (using <code>printf()</code>) together with their servant ID.</li>
<li>The king thread goes to sleep again.</li>
</ul>
<p>Take note of these things as well:</p>
<ul>
<li>You can find some concrete code examples of pthread semaphores in the code on the bottom of Assignment 3!</li>
<li>Every servant needs to greet the king <strong>once</strong> (no more, no less)</li>
<li>The king <strong>doesn&rsquo;t</strong> wait for the servant greetings before he goes back to sleep</li>
<li>You do not need to make sure that the servants always reply in the same order</li>
<li>Repeat the wake-greet cycle at least 10 times</li>
<li>Tip: use the <code>rand()</code> function to get random numbers</li>
</ul>
<h3 id="polite-king">Polite king</h3>
<p><strong>REVISIT, WITH A TWEAK</strong> Change the previous king-servant setup with a single change: now, the king <strong>does</strong> explicitly wait for the greetings of <em>all</em> his servants before he goes back to sleep.</p>
<p>Think about if you need additional semaphores/mutexes for this and why.</p>
<figure>
    <img src="../../img/os/sc_642.png"/> <figcaption>
            <h4>An example output</h4>
        </figcaption>
</figure>
<h2 id="deadlock-empire-the-endgame">Deadlock Empire: The Endgame</h2>
<ul>
<li>Go to the Deadlock Empire website and complete these two exercises:
<ul>
<li>The Final Stretch: Dragonfire</li>
<li>The Final Stretch: Triple Danger</li>
</ul>
</li>
</ul>
<h2 id="producer-consumer-v1--single-mutex">Producer-Consumer V1 : Single mutex</h2>
<p>In the prime-number exercises in the previous labs, we were actually implementing the basics of a producer-consumer problem, without really knowing it! In our example solution, we bypassed the shared memory issue by assigning each producer (the <code>calculatePrimes</code> function) a separate block of memory only they could use/access to place their results. As you know now, this is highly inefficient and a waste of memory. As such, it&rsquo;s time to make our prime-number into a proper producer-consumer setup with a single shared memory array of a limited size!</p>
<p><strong>We will do this in several steps, starting with a somewhat sub-optimal mutex-based solution and ending up with a more complex semaphore-based one!</strong></p>
<p>Start from the provided solution to the last prime-number exercise (<code>6_5_3_primethreads.c</code>). Change it so:</p>
<ul>
<li>All 4 producer threads write their results to a <strong>single</strong> shared array instead of the 4 separate <code>results</code> arrays (note: this single array will still be quite large, say 20000 integers).</li>
<li>Make a new <code>printPrimes()</code> function that acts as the consumer. Use <code>pthread_create</code> in <code>main</code> to start a single instance of the consumer. Make sure this function prints newly produced primes <strong>as soon as possible</strong>/as soon as they&rsquo;re put in the shared array (meaning: we&rsquo;re no longer waiting for all the producers to be done before starting to print the results in <code>main()</code>).</li>
</ul>
<p>For this, you should use a <strong>single mutex</strong> to prevent the producers/consumers from having race conditions on the single shared array.</p>
<ul>
<li>Tip: use a global <code>write_index</code> variable to manipulate the shared array</li>
</ul>
<p><em>Note: in this setup, the primes will no longer be printed in-order from smallest to largest. That&rsquo;s fine ;)</em> <strong>Can you explain why though??? And can you imagine a possible solution where they -are- still printed in-order?</strong></p>
<h2 id="producer-consumer-v2--proper-close">Producer-Consumer V2 : Proper close</h2>
<p>One thing you might/should have noticed in the previous exercise, is that it&rsquo;s no longer easy to determine when the consumer should stop printing/when it has printed all produced primes.</p>
<p>In the original solution <code>6_5_3_primethreads.c</code>, we had the producers write the number <code>0</code> at the end of their result array to signal they were done (because <code>0</code> is not a prime). In the new setup however, we can&rsquo;t use this anymore, because not all producers end at the same time, and so new &ldquo;real&rdquo; primes might be written after a <code>0</code> from the first finished producer!</p>
<p>As such, we need a new way to determine when we&rsquo;re done: <strong>keep a count of producers that are done</strong>. Then, the consumer can check if this &ldquo;done count&rdquo; is equal to the number of producers. If so, it can safely exit without having to rely on the <code>0</code> <em>sentinel value</em>.</p>
<ul>
<li>Extend your previous code to keep a <strong>thread-safe</strong> &ldquo;done count&rdquo; of the number of finished producers.</li>
<li>Make sure your consumer properly checks this &ldquo;done count&rdquo; (again in a <strong>thread-safe</strong> way!) and that it also properly exits/returns when all primes are printed.</li>
</ul>
<p>Keeping the &ldquo;done count&rdquo; thread safe can be done in two main ways. Choose one:</p>
<ul>
<li>Use a count variable and a mutex</li>
<li>Use a semaphore as a counter. (tip: here it might help to use the <code>sem_getvalue()</code> function. Look up online what that does and how to use it).</li>
</ul>
<h2 id="producer-consumer-v3--multiple-consumers">Producer-Consumer V3 : Multiple consumers</h2>
<p>In the previous two versions, we had only a single consumer. To get maximum performance, we of course would like to not just have multiple producers, but also <strong>multiple consumers</strong>!</p>
<p>Extend your previous solution to:</p>
<ul>
<li>Create at least 2 <code>printPrimes</code> consumer threads (ideally more!), that all read from the shared array and print the produced primes. Of course you need to make sure no primes are printed twice (= <strong>thread-safe</strong> access to the shared array from all consumers)!!!</li>
</ul>
<p>Note: this can again be done in several ways. The simplest/best way however, doesn&rsquo;t even require you to define a new mutex here; you can just re-use the one from the V1 above. Tip for this: previously we just had a global write_index, now we also need another type of global index ;)</p>
<h2 id="producer-consumer-v4--semaphores">Producer-Consumer V4 : Semaphores</h2>
<p>Up until now, you&rsquo;ve used (should have been using?) mainly mutexes to access a single (huge) shared array. Because the array is so large, we didn&rsquo;t have the typical mutex problems like busy waiting, because there was always room for newly produced primes to be placed in the shared memory (unless we had very high limits for the prime generation).</p>
<p>To forcibly show the usefulness of semaphores when we don&rsquo;t have &ldquo;unlimited&rdquo; shared memory, you will now adapt your previous code to:</p>
<ul>
<li>Use semaphores instead of mutexes (<em>at least for the main shared memory, you can still use a mutex for the &ldquo;done count&rdquo; if you did that</em>)</li>
<li>Use only the <strong>minimal amount of shared memory</strong>. Put differently: the shared array is now only <strong>a single integer in size</strong> instead of say 20000. All producers and all consumers can only use this single shared &ldquo;memory location&rdquo; to pass individual primes from one to the other. Consequently, this single &ldquo;shelf&rdquo; needs to be <strong>ultra-thread-safe</strong>!</li>
</ul>
<p>Tip: These changes shouldn&rsquo;t be too large (though also not tiny ;)). Nor should they be very different from the producer-consumer semaphore examples shown in the course text.</p>
<p><em>Note: think about if you still need a mutex inside of your semaphore(s) as well. Why (not)? Look up the discussion on &ldquo;binary semaphores&rdquo; in the course text. Is this the same/a similar situation or not?</em></p>
<p><strong>Note: this exercise is a mandatory part of Assignment 3. While the assignments are individual, you CAN (and should) collaborate on this exercise! The solution will be posted only after the deadline for assignment 3 however.</strong></p>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../ch6-tasks/interthread/" title="6.6: Inter Thread communication"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../ch7-scheduling/" title="7: CPU scheduling" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1650362829"></script>
    <script src="../../js/perfect-scrollbar.min.js?1650362829"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1650362829"></script>
    <script src="../../js/jquery.sticky.js?1650362829"></script>
    <script src="../../js/featherlight.min.js?1650362829"></script>
    <script src="../../js/modernizr.custom-3.6.0.js?1650362829"></script>
    <script src="../../js/learn.js?1650362829"></script>
    <script src="../../js/hugo-learn.js?1650362829"></script>
    
        
            <script src="../../mermaid/mermaid.js?1650362829"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    <script>
    window.MathJax = {
      chtml: {
        scale: 2,                      
        minScale: .5,                  
        matchFontHeight: true,         
        mtextInheritFont: false,       
        merrorInheritFont: true,       
        mathmlSpacing: false,          
        skipAttributes: {},            
        exFactor: .5,                  
        displayAlign: 'center',        
        displayIndent: '0'             
      }
    };
    </script>
    
    

  </body>
</html>

