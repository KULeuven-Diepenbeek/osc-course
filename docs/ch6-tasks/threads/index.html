<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>6.4: Threads :: Operating Systems and C</title>

    
    <link href="../../css/nucleus.css?1618847767" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1618847767" rel="stylesheet">
    <link href="../../css/hybrid.css?1618847767" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1618847767" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1618847767" rel="stylesheet">
    <link href="../../css/auto-complete.css?1618847767" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1618847767" rel="stylesheet">
    <link href="../../css/theme.css?1618847767" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1618847767" rel="stylesheet">
    
    <link href="../../css/theme-kul.css?1618847767" rel="stylesheet">
    
    

    <script src="../../js/jquery-3.3.1.min.js?1618847767"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
      <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

<script>
window.MathJax = {
  chtml: {
    scale: 2,                      
    minScale: .5,                  
    matchFontHeight: true,         
    mtextInheritFont: false,       
    merrorInheritFont: true,       
    mathmlSpacing: false,          
    skipAttributes: {},            
    exFactor: .5,                  
    displayAlign: 'center',        
    displayIndent: '0'             
  }
};
</script>

<script src=../../js/osc.js></script>
  </head>
  <body class="" data-url="../../ch6-tasks/threads/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
	<img src="../../img/style/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
	<img src="../../img/style/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1618847767"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1618847767"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/kuleuven-diepenbeek.github.io\/osc-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1618847767"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='../../'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ch1-c/" title="1: Introduction in C" class="dd-item
        
        
        
        ">
      <a href="../../ch1-c/">
          <i class='far fa-keyboard'></i> 1: Introduction in C
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/intro/" title="1.1: The C programming language" class="dd-item ">
        <a href="../../ch1-c/intro/">
        <i class='fas fa-book'></i> 1.1: The C programming language
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/intro-labs/" title="1.2: String Manipulation" class="dd-item ">
        <a href="../../ch1-c/intro-labs/">
        <i class='fas fa-vial'></i> 1.2: String Manipulation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/structs/" title="1.3: Creating order: Structures" class="dd-item ">
        <a href="../../ch1-c/structs/">
        <i class='fas fa-book'></i> 1.3: Creating order: Structures
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/structs-labs/" title="1.4: Structs" class="dd-item ">
        <a href="../../ch1-c/structs-labs/">
        <i class='fas fa-vial'></i> 1.4: Structs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/ecosystems/" title="1.5: C Ecosystems" class="dd-item ">
        <a href="../../ch1-c/ecosystems/">
        <i class='fas fa-book'></i> 1.5: C Ecosystems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-c/ecosystems-labs/" title="1.6: Splitting up Code" class="dd-item ">
        <a href="../../ch1-c/ecosystems-labs/">
        <i class='fas fa-vial'></i> 1.6: Splitting up Code
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch2-interrupts/" title="2: Interrupts" class="dd-item
        
        
        
        ">
      <a href="../../ch2-interrupts/">
          <i class='fab fa-linux'></i> 2: Interrupts
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch2-interrupts/theory1_arduino/" title="2.1 Arduino UNO" class="dd-item ">
        <a href="../../ch2-interrupts/theory1_arduino/">
        <i class='fab fa-linux'></i> 2.1 Arduino UNO
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-interrupts/lab1_arduino-multfreq/" title="2.2: Arduino multi frequencies" class="dd-item ">
        <a href="../../ch2-interrupts/lab1_arduino-multfreq/">
        <i class='fas fa-vial'></i> 2.2: Arduino multi frequencies
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-interrupts/theory2_timer/" title="2.3 The timer" class="dd-item ">
        <a href="../../ch2-interrupts/theory2_timer/">
        <i class='fab fa-linux'></i> 2.3 The timer
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-interrupts/lab2_rocketlaunch/" title="2.4: Launch that rocket !!" class="dd-item ">
        <a href="../../ch2-interrupts/lab2_rocketlaunch/">
        <i class='fas fa-vial'></i> 2.4: Launch that rocket !!
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch3-pointers/" title="3: Pointers &amp; Arrays" class="dd-item
        
        
        
        ">
      <a href="../../ch3-pointers/">
          <i class='far fa-keyboard'></i> 3: Pointers &amp; Arrays
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch3-pointers/pointers/" title="3.1: Pointers and arrays" class="dd-item ">
        <a href="../../ch3-pointers/pointers/">
        <i class='far fa-keyboard'></i> 3.1: Pointers and arrays
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-pointers/practical-use/" title="3.2: Practical Use of Pointers" class="dd-item ">
        <a href="../../ch3-pointers/practical-use/">
        <i class='far fa-keyboard'></i> 3.2: Practical Use of Pointers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-pointers/lab/" title="3.3: The Ancient Library" class="dd-item ">
        <a href="../../ch3-pointers/lab/">
        <i class='fas fa-vial'></i> 3.3: The Ancient Library
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch4-debugging/" title="4: Debugging" class="dd-item
        
        
        
        ">
      <a href="../../ch4-debugging/">
          <i class='far fa-keyboard'></i> 4: Debugging
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch4-debugging/debugging-ide/" title="4.1: The Easy Way: IDEs" class="dd-item ">
        <a href="../../ch4-debugging/debugging-ide/">
        <i class='far fa-keyboard'></i> 4.1: The Easy Way: IDEs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-debugging/debugging-gdb/" title="4.2: The Hard Way: GDB" class="dd-item ">
        <a href="../../ch4-debugging/debugging-gdb/">
        <i class='fas fa-vial'></i> 4.2: The Hard Way: GDB
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-debugging/testing/" title="4.3: The Middle Way: TDD" class="dd-item ">
        <a href="../../ch4-debugging/testing/">
        <i class='far fa-keyboard'></i> 4.3: The Middle Way: TDD
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch5-introos/" title="5: Intro in OS" class="dd-item
        
        
        
        ">
      <a href="../../ch5-introos/">
          <i class='fab fa-linux'></i> 5: Intro in OS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch5-introos/intro-os/" title="5.1: Intro to OS using Linux" class="dd-item ">
        <a href="../../ch5-introos/intro-os/">
        <i class='fas fa-book'></i> 5.1: Intro to OS using Linux
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch5-introos/lab1_wetfeet/" title="5.2: Getting your CLI-feet wet" class="dd-item ">
        <a href="../../ch5-introos/lab1_wetfeet/">
        <i class='fas fa-vial'></i> 5.2: Getting your CLI-feet wet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch6-tasks/" title="6: Task management" class="dd-item
        parent
        
        
        ">
      <a href="../../ch6-tasks/">
          <i class='fab fa-linux'></i> 6: Task management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/processes/" title="6.1: Processes" class="dd-item ">
        <a href="../../ch6-tasks/processes/">
        <i class='fas fa-book'></i> 6.1: Processes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab1_processmgmt/" title="6.2: Processes (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab1_processmgmt/">
        <i class='fas fa-vial'></i> 6.2: Processes (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/interprocess/" title="6.3: Inter Process communication" class="dd-item ">
        <a href="../../ch6-tasks/interprocess/">
        <i class='fas fa-book'></i> 6.3: Inter Process communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/threads/" title="6.4: Threads" class="dd-item active">
        <a href="../../ch6-tasks/threads/">
        <i class='fas fa-book'></i> 6.4: Threads
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab2_threadsmgmt/" title="6.5: Threads (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab2_threadsmgmt/">
        <i class='fas fa-vial'></i>6.5: Threads (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/interthread/" title="6.6: Inter Thread communication" class="dd-item ">
        <a href="../../ch6-tasks/interthread/">
        <i class='fas fa-book'></i> 6.6: Inter Thread communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab3_interthreadcomm/" title="6.7: Inter-Thread communication (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab3_interthreadcomm/">
        <i class='fas fa-vial'></i> 6.7: Inter-Thread communication (lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch7-scheduling/" title="7: CPU scheduling" class="dd-item
        
        
        
        ">
      <a href="../../ch7-scheduling/">
          <i class='fab fa-linux'></i> 7: CPU scheduling
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/algorithms/" title="7.1: Scheduling algorithms" class="dd-item ">
        <a href="../../ch7-scheduling/algorithms/">
        <i class='fas fa-book'></i> 7.1: Scheduling algorithms
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab1_algorithms/" title="7.2: Scheduling algorithms (lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab1_algorithms/">
        <i class='fas fa-vial'></i> 7.2: Scheduling algorithms (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/towards/" title="7.3: Towards real-world schedulers" class="dd-item ">
        <a href="../../ch7-scheduling/towards/">
        <i class='fas fa-book'></i> 7.3: Towards real-world schedulers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab2_niceguy/" title="7.4: Mr. nice guy(lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab2_niceguy/">
        <i class='fas fa-vial'></i> 7.4: Mr. nice guy(lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch8-stack/" title="8: The Stack &amp; The Heap" class="dd-item
        
        
        
        ">
      <a href="../../ch8-stack/">
          <i class='far fa-keyboard'></i> 8: The Stack &amp; The Heap
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/stackvsheap/" title="8.1: The Stack &amp; the Heap" class="dd-item ">
        <a href="../../ch8-stack/stackvsheap/">
        <i class='fas fa-book'></i> 8.1: The Stack &amp; the Heap
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/inspection-labs/" title="8.2: Inspecting memory regions" class="dd-item ">
        <a href="../../ch8-stack/inspection-labs/">
        <i class='fas fa-vial'></i> 8.2: Inspecting memory regions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/scope/" title="8.3: Different Scopes in C" class="dd-item ">
        <a href="../../ch8-stack/scope/">
        <i class='fas fa-book'></i> 8.3: Different Scopes in C
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch9-memory/" title="9: Memory Management" class="dd-item
        
        
        
        ">
      <a href="../../ch9-memory/">
          <i class='fab fa-linux'></i> 9: Memory Management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/memory/" title="9.1: Memory management" class="dd-item ">
        <a href="../../ch9-memory/memory/">
        <i class='fas fa-book'></i> 9.1: Memory management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab1_segfault/" title="9.2: Deliberate Segfaulting" class="dd-item ">
        <a href="../../ch9-memory/lab1_segfault/">
        <i class='fas fa-vial'></i> 9.2: Deliberate Segfaulting
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/paging/" title="9.3: Paging" class="dd-item ">
        <a href="../../ch9-memory/paging/">
        <i class='fas fa-book'></i> 9.3: Paging
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab2_browsing/" title="9.4: Simply browsing through pages" class="dd-item ">
        <a href="../../ch9-memory/lab2_browsing/">
        <i class='fas fa-vial'></i> 9.4: Simply browsing through pages
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/chx-cs/" title="X: Capita Selecta" class="dd-item
        
        
        
        ">
      <a href="../../chx-cs/">
          <i class='fab fa-linux'></i> X: Capita Selecta
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/filesystems/" title="X.1: File systems" class="dd-item ">
        <a href="../../chx-cs/filesystems/">
        <i class='fab fa-linux'></i> X.1: File systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/rtos/" title="X.2: Real-time Operating Systems" class="dd-item ">
        <a href="../../chx-cs/rtos/">
        <i class='fab fa-linux'></i> X.2: Real-time Operating Systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/devdrivers/" title="X.3: Device Drivers" class="dd-item ">
        <a href="../../chx-cs/devdrivers/">
        <i class='fab fa-linux'></i> X.3: Device Drivers
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/exercises/" title="A. Exercises Assignments" class="dd-item
        
        
        
        ">
      <a href="../../exercises/">
          <i class='fas fa-pencil-alt'></i> A. Exercises Assignments
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/exercises/c-integrated-ex/" title="1. Integrated C exercise" class="dd-item ">
        <a href="../../exercises/c-integrated-ex/">
        <i class='fas fa-pen-square'></i> 1. Integrated C exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/c-debugging-testing/" title="2. Testing in C(&#43;&#43;)" class="dd-item ">
        <a href="../../exercises/c-debugging-testing/">
        <i class='fas fa-pen-square'></i> 2. Testing in C(&#43;&#43;)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/tasks_inter_thread_communication/" title="3. Inter-thread communication" class="dd-item ">
        <a href="../../exercises/tasks_inter_thread_communication/">
        <i class='fas fa-pen-square'></i> 3. Inter-thread communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/exercises/scheduler/" title="4. Pseudo scheduler" class="dd-item ">
        <a href="../../exercises/scheduler/">
        <i class='fas fa-pen-square'></i> 4. Pseudo scheduler
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/appendix/" title="B. Appendix" class="dd-item
        
        
        
        ">
      <a href="../../appendix/">
          <i class='fab fa-github'></i> B. Appendix
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/appendix/lab_ll_rtos/" title="3.3: The Ancient Library (RTOS)" class="dd-item ">
        <a href="../../appendix/lab_ll_rtos/">
        <i class='fas fa-vial'></i> 3.3: The Ancient Library (RTOS)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/reading/" title="1. Recommended reading" class="dd-item ">
        <a href="../../appendix/reading/">
        1. Recommended reading
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/installing/" title="2. Linux Installation Instructions" class="dd-item ">
        <a href="../../appendix/installing/">
        2. Linux Installation Instructions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/cheat_sheet/" title="Cheat sheet" class="dd-item ">
        <a href="../../appendix/cheat_sheet/">
        Cheat sheet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://uhintra03.uhasselt.be/studiegidswww/opleidingsonderdeel.aspx?a=2019&amp;i=4082&amp;n=4&amp;t=01"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://kuleuven-diepenbeek.github.io/osc-course/TODO"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Operating Systems and C</a> > <a href='../../ch6-tasks/'>6: Task management</a> > 6.4: Threads
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#what-s-in-a-thread">What&rsquo;s in a thread ?</a></li>
<li><a href="#why-would-we-want-multiple-threads">Why would we want multiple threads ?</a>
<ul>
<li><a href="#amdahl-s-law">Amdahl&rsquo;s law</a></li>
<li><a href="#user-threads-vs-system-threads">User threads vs system threads</a></li>
</ul></li>
<li><a href="#creating-threads">Creating threads</a>
<ul>
<li><a href="#pthreads">Pthreads</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              6.4: Threads
            </h1>
          

        




<p>In the previous three sections we have discussed that you can run multiple processes at the same time and how this is managed by the OS. This can be useful in two ways: either a) to use multiple programs at the same time (e.g., your Web browser and music player), or b) to make efficient use of multiple hardware CPUs or processing cores.</p>

<p>We have however also seen that this is not trivial: new processes need their own memory space and associated state (the PCB) and communication between processes is either flexible but complex (shared memory) or straightforward but limited (message passing).</p>

<p>Luckily, there is another way to split up processes into smaller subtasks and make more efficient use of multicore hardware without incurring as much overhead. This is accomplished using <strong>Threads</strong>.</p>

<p>A thread is an independent unit of execution within a process. Put differently, it&rsquo;s a sequence of code instructions that can be executed independently from and, crucially, in parallel with other threads. As such, each thread can for example be assigned to a single CPU core for parallel processing.</p>

<h2 id="what-s-in-a-thread">What&rsquo;s in a thread ?</h2>

<p>Up until now all the processes that were discussed contained just one thread (sometimes called the <strong>main</strong> thread). Such a process is referred to as a <strong>single-threaded process</strong>:</p>

<figure>
    <img src="../../img/os/db_singlethreaded_v2.png"/> <figcaption>
            <h4>The single threaded process</h4>
        </figcaption>
</figure>

<p>Let&rsquo;s examine the image above. On the top of this image the following segments are mentioned: <strong>code</strong>, <strong>heap</strong>, and (open) <strong>files</strong>, alongside the <strong>registers</strong>, <strong>program counter</strong> and the <strong>stack</strong>.</p>

<p>As we&rsquo;ve seen, when multiple processes run at the same time, every individual process has separate and <strong>isolated</strong> instances of all these segments, like shown in the image below:</p>

<figure>
    <img src="../../img/os/db_singlethreaded_twice_v2.png"/> <figcaption>
            <h4>Two single threaded processes running in parallel</h4>
        </figcaption>
</figure>

<p>However, the name &ldquo;single-threaded&rdquo; of course also implies the existence of <strong>multi-threaded</strong> processes, which have more than one thread. Each of these threads can execute in parallel and as such also need their own copies of some of the segments: the register contents, current program counter and the full stack are now <strong>independent</strong> for each thread. You could say that each thread has its own &ldquo;Thread Control Block&rdquo; (in analogy with the PCB), which tracks this metadata. However, the main difference between parallel threads and parallel processes is that threads do still <strong>share many things</strong>: the copy of the code, the (open) files and the heap memory. This is one reason why threads are more lightweight than processes, as they don&rsquo;t require copying these segments when new threads are created.</p>

<figure>
    <img src="../../img/os/db_multithreaded_v2.png"/> <figcaption>
            <h4>A single-threaded vs multi-threaded process</h4>
        </figcaption>
</figure>

<style>
  div.twocolumns {
    display: flex;
    flex-direction: row;
    justify-content: space-around;
  }
  div.column {
    width: 35%;
  }
  div.column ul {
    margin-top: 0px;
  }
</style>

<div class="twocolumns">
  <div class="column">
    The multiple threads in a multi-threaded process <b>share</b>:
    <ul>
      <li>the code segment</li>
      <li>the heap memory</li>
      <li>the list of open files</li>
    </ul>
  </div>
  <div class="column">
    The multiple threads in a multi-threaded process <b>have unique/independent</b>:
    <ul>
      <li>register contents</li>
      <li>program counters</li>
      <li>stack memory</li>
    </ul>
  </div>
</div>

<h2 id="why-would-we-want-multiple-threads">Why would we want multiple threads ?</h2>

<p>There are 4 major benefits to working with multiple threads:</p>

<ol>
<li><strong>Responsiveness</strong>: When a single program is broken down into multiple threads, the user experience feels more responsive. Dedicated threads can be created to handle user requests and give (visual) feedback, while other threads can for example process data in the background.</li>
<li><strong>Resource sharing</strong>: Programs that have multiple threads typically want some sort of communication between these threads. This is done more easily between threads than between processes, as threads <em>implicitly</em> share memory via their heap.</li>
<li><strong>Economy</strong>: Context switching becomes cheaper when switching between threads in comparison to switching between processes. This is because less per-thread state needs to be tracked, in comparison to more per-process state.</li>
<li><strong>Scalability</strong>: Multiple threads can run in parallel on multi-core systems in contrast to a single threaded process.</li>
</ol>


<div class="notices warning" ><p>Although there are <strong>many advantages</strong> to multi-threaded programming, it requires <strong>skilled programming</strong> to cash in on these opportunities. Not all code can be easily parallelized and communication between threads is not trivial. We will focus on these aspects in the remainder of this chapter.</p>
</div>


<h3 id="amdahl-s-law">Amdahl&rsquo;s law</h3>

<p>While threading seems like the ideal, lightweight solution to make your programs run faster, it might be surprising to hear that program performance typically <strong>does not scale linearly</strong> with the amount of threads and/or amount of CPU cores. This is because typically not all code in a process can be parallelized (and thus run in separate threads): there are typically parts of code that need to aggregate results from the parallel computations, which can only be done in a serial fashion. This can be seen in the following image:</p>

<figure>
    <img src="../../img/os/serial_vs_parallel.png"/> <figcaption>
            <h4>Parallel processing can lead to serial phases in a process. Source: J. Wolf et al. - Contribution to the Fluid-Structure Interaction Analysis of Ultra-Lightweight Structures using an Embedded Approach</h4>
        </figcaption>
</figure>

<p>A theoretical model for assessing the maximal gains from multithreading a program was developed by Gene Amdahl in 1967. His formula identifies potential performance gains from adding additional computing cores to an application that has both serial and parallel components:</p>

<p style="text-align:center;">
  \( 
speedup < { 1 \over { S + { (1-S) \over N } } }
 \)
</p>

<p>In this formula <strong>S</strong> stands for the portion of the application that <em>has to be</em> run serially. <strong>N</strong> stands for the number of cores on which the parallel portion is spread. We can see that to maximize the speedup, we need to keep the divisor of the fraction as small as possible. This is done by keeping S as small as possible, and N as high as possible.</p>

<figure>
    <img src="../../img/os/amdahl.png"/> <figcaption>
            <h4>Source: Wikipedia</h4>
        </figcaption>
</figure>

<p>The graph above visualises Amdahl&rsquo;s law. For example, as marked by the red dot, if a program has 80% of its code that can be run in parallel (and so 20% of the code has to be run serially), it can be run at maximum 2.5 times faster, using 4 cores. If only 50% of the code can be run in parallel, the amount of cores matters much less, with a maximum speedup of 2x being possible even with 16 cores.</p>

<p>However, as stated above, it requires a skilled programmer to achieve maximal speed-up even if a large part of the program can be parallelized. If the program needs a lot of data that needs to be communicated between the serial and parallel portions this becomes even harder to achieve, as this can also cause additional slowdowns.</p>

<h3 id="user-threads-vs-system-threads">User threads vs system threads</h3>

<p>By now, you might still think that using threads is only useful if you have multiple processors, or, if you do have multiple CPU cores, that you should only use as many threads as you have cores. However, this is somewhat incorrect.</p>

<p>While it is true that you might not get a speedup if the number of threads is larger than the number of cores, that does not mean you cannot run tasks in a seemingly parallel fashion. Take for example the simplest case where you have two threads and just a single CPU core. Like with the processes, this does not mean that thread 1 will run fully before thread 2 can start. Instead, the OS will again <strong>schedule</strong> the threads, pausing one and (re-)starting the other several times in quick succession.</p>

<p>As processor speeds are many times what the typical human would notice, this often gives the illusion of parallel execution. A good example is the &ldquo;Responsiveness&rdquo; benefit mentioned above, achieved by using a separate thread for User input/User interface updates. Even if the program has a thread executing heavy calculations, the UI thread will get enough CPU time to listen to User input.</p>

<p>As such, there is often not a direct one-to-one mapping between threads and actual processor cores. Internally, the OS has a concept of <strong>Kernel threads</strong> that it schedules and divides between the processors. The threads we create, sometimes called <strong>User threads</strong> can be mapped onto those kernel threads in several different ways (e.g., one-to-one, one-to-many, many-to-many) and this mapping can also change over time (e.g., transferring a thread to a different CPU). The exact details are out of scope for this course, but it&rsquo;s useful to know that you typically won&rsquo;t control directly how your threads run. In a multi-process setup (which is typical for most OSes) you typically can&rsquo;t even guarantee that all the threads for a given process are really all running in parallel, as other threads from other processes might also require CPU time. This makes it even more difficult in practice to measure and ensure the speedup from using multiple threads.</p>

<h2 id="creating-threads">Creating threads</h2>

<p>Before discussing how to communicate between threads however, we first look at how we can create threads in C.</p>

<p>In the previous sections on processes, multiple processes could be created through the <em>fork</em> and <em>exec</em> functions. These function wrap the OS system-calls that are required to achieve this. Therefore, this comes intrinsically with the OS.</p>

<p>Threads are of course also fully supported by the OS, but they typically require a more high-level API to easily work with. Most programming languages provide their own versions of these APIs, but they all internally call the OS-provided functionality. As we are working with Linux, we will be using the standard POSIX API library called Pthreads.</p>

<h3 id="pthreads">Pthreads</h3>

<p>An example for creating a new pthread is given below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;pthread.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> counter;

<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span> <span style="color:#a6e22e">doSomeThing</span>() {
    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    counter <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;

    printf(<span style="color:#e6db74">&#34;  Job %d started</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, counter);
    <span style="color:#66d9ef">for</span>(i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>(<span style="color:#ae81ff">0xFFFFFFFF</span>); i<span style="color:#f92672">++</span>) {
        <span style="color:#75715e">// do nothing
</span><span style="color:#75715e"></span>    }
    printf(<span style="color:#e6db74">&#34;  Job %d finished</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, counter);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>) {
  <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, err;
  pthread_t tid[<span style="color:#ae81ff">2</span>];
  counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

  <span style="color:#66d9ef">while</span>(i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>) {

    <span style="color:#75715e">// 1. pointer to pthread_t to keep thread state, 2. configuration arguments for the thread (we use the defaults here)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 3. pointer to function that runs in separate thread, 4. parameters to pass to the thread (empty for doSomeThing)
</span><span style="color:#75715e"></span>    err <span style="color:#f92672">=</span> pthread_create(<span style="color:#f92672">&amp;</span>(tid[i]), NULL, <span style="color:#f92672">&amp;</span>doSomeThing, NULL);

    <span style="color:#66d9ef">if</span> (err <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
      printf(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">can&#39;t create thread :[%s]&#34;</span>, strerror(err));
    }

    i<span style="color:#f92672">++</span>;
  }

  <span style="color:#75715e">// Pauze the main thread until the thread in the first argument is terminated
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// If the thread was already terminated, pthread_join continues immediately
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// The second argument can be used to store the return value of the thread
</span><span style="color:#75715e"></span>  pthread_join(tid[<span style="color:#ae81ff">0</span>], NULL);
  pthread_join(tid[<span style="color:#ae81ff">1</span>], NULL);

  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}</code></pre></div>

<div class="notices note" ><p>When the code above gets compiled, the <strong>pthread</strong> library has to be used. This library contains the object files that implemented the functions <em>pthread_create()</em> and <em>pthread_join()</em>. Compilation can be done because of the <code>#include &lt;pthread.h&gt;</code> line. For linking however, you have to separately tell gcc to use the pthread library as well by adding <code>-lpthread</code> (e.g., <code>gcc -o program program.c -lpthread</code>).</p>
</div>


<figure>
    <img src="../../img/os/sc_compile.png"/> 
</figure>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../ch6-tasks/interprocess/" title="6.3: Inter Process communication"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../ch6-tasks/lab2_threadsmgmt/" title="6.5: Threads (lab)" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1618847767"></script>
    <script src="../../js/perfect-scrollbar.min.js?1618847767"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1618847767"></script>
    <script src="../../js/jquery.sticky.js?1618847767"></script>
    <script src="../../js/featherlight.min.js?1618847767"></script>
    <script src="../../js/highlight.pack.js?1618847767"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js?1618847767"></script>
    <script src="../../js/learn.js?1618847767"></script>
    <script src="../../js/hugo-learn.js?1618847767"></script>
    
        
            <script src="../../mermaid/mermaid.js?1618847767"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

