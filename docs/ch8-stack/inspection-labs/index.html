<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>8.2: Inspecting memory regions :: Operating Systems and C</title>

    
    <link href="../../css/nucleus.css?1675691513" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1675691513" rel="stylesheet">
    <link href="../../css/hybrid.css?1675691513" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1675691513" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1675691513" rel="stylesheet">
    <link href="../../css/auto-complete.css?1675691513" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1675691513" rel="stylesheet">
    <link href="../../css/theme.css?1675691513" rel="stylesheet">
    <link href="../../css/devselector.css?1675691513" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1675691513" rel="stylesheet">
    <link href="../../css/theme-kul.css?1675691513" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1675691513"></script>
    <script src="../../js/devselector.js?1675691513"></script>
    <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    <script src="../../js/osc.js"></script>

  </head>
  <body class="" data-url="../../ch8-stack/inspection-labs/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../images/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../images/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1675691513"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1675691513"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/kuleuven-diepenbeek.github.io\/osc-course\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1675691513"></script>

    
  </div>

    <div class="highlightable">

      <h3><a href="../../">Course Contents</a></h3>
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ch1-introos/" title="1: Intro in OS" class="dd-item
        
        
        
        ">
      <a href="../../ch1-introos/">
          <i class='fab fa-linux'></i> 1: Intro in OS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/intro-os/" title="1.1: Intro to OS using Linux" class="dd-item ">
        <a href="../../ch1-introos/intro-os/">
        <i class='fas fa-book'></i> 1.1: Intro to OS using Linux
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/filesystems/" title="1.2: File systems" class="dd-item ">
        <a href="../../ch1-introos/filesystems/">
        <i class='fab fa-linux'></i> 1.2: File systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch1-introos/cli/" title="1.3: Getting your CLI-feet wet" class="dd-item ">
        <a href="../../ch1-introos/cli/">
        <i class='fas fa-vial'></i> 1.3: Getting your CLI-feet wet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch2-c/" title="2: Introduction in C" class="dd-item
        
        
        
        ">
      <a href="../../ch2-c/">
          <i class='far fa-keyboard'></i> 2: Introduction in C
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/intro/" title="2.1: The C programming language" class="dd-item ">
        <a href="../../ch2-c/intro/">
        <i class='fas fa-book'></i> 2.1: The C programming language
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/intro-labs/" title="2.2: String Manipulation" class="dd-item ">
        <a href="../../ch2-c/intro-labs/">
        <i class='fas fa-vial'></i> 2.2: String Manipulation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/structs/" title="2.3: Creating order: Structures" class="dd-item ">
        <a href="../../ch2-c/structs/">
        <i class='fas fa-book'></i> 2.3: Creating order: Structures
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/structs-labs/" title="2.4: Structs" class="dd-item ">
        <a href="../../ch2-c/structs-labs/">
        <i class='fas fa-vial'></i> 2.4: Structs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/ecosystems/" title="2.5: C Ecosystems" class="dd-item ">
        <a href="../../ch2-c/ecosystems/">
        <i class='fas fa-book'></i> 2.5: C Ecosystems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch2-c/ecosystems-labs/" title="2.6: Splitting up Code" class="dd-item ">
        <a href="../../ch2-c/ecosystems-labs/">
        <i class='fas fa-vial'></i> 2.6: Splitting up Code
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch3-introcpu/" title="3: Introduction in CPU" class="dd-item
        
        
        
        ">
      <a href="../../ch3-introcpu/">
          <i class='fab fa-linux'></i> 3: Introduction in CPU
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/1_vonneumann/" title="3.1 Von Neumann Architecture" class="dd-item ">
        <a href="../../ch3-introcpu/1_vonneumann/">
        <i class='fab fa-linux'></i> 3.1 Von Neumann Architecture
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/1_lab_assembly/" title="3.2: Assembly basics" class="dd-item ">
        <a href="../../ch3-introcpu/1_lab_assembly/">
        <i class='fas fa-vial'></i> 3.2: Assembly basics
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/2_functions/" title="3.3 Functions and The Stack" class="dd-item ">
        <a href="../../ch3-introcpu/2_functions/">
        <i class='fab fa-linux'></i> 3.3 Functions and The Stack
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch3-introcpu/2_lab_stack/" title="3.4: The Stack" class="dd-item ">
        <a href="../../ch3-introcpu/2_lab_stack/">
        <i class='fas fa-vial'></i> 3.4: The Stack
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch4-pointers/" title="4: Pointers &amp; Arrays" class="dd-item
        
        
        
        ">
      <a href="../../ch4-pointers/">
          <i class='far fa-keyboard'></i> 4: Pointers &amp; Arrays
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/pointers/" title="4.1: Pointers and arrays" class="dd-item ">
        <a href="../../ch4-pointers/pointers/">
        <i class='far fa-keyboard'></i> 4.1: Pointers and arrays
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/practical-use/" title="4.2: Practical Use of Pointers" class="dd-item ">
        <a href="../../ch4-pointers/practical-use/">
        <i class='far fa-keyboard'></i> 4.2: Practical Use of Pointers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch4-pointers/lab/" title="4.3: The Ancient Library" class="dd-item ">
        <a href="../../ch4-pointers/lab/">
        <i class='fas fa-vial'></i> 4.3: The Ancient Library
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch5-debugging/" title="5: Debugging" class="dd-item
        
        
        
        ">
      <a href="../../ch5-debugging/">
          <i class='far fa-keyboard'></i> 5: Debugging
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/debugging-ide/" title="5.1: The Easy Way: IDEs" class="dd-item ">
        <a href="../../ch5-debugging/debugging-ide/">
        <i class='far fa-keyboard'></i> 5.1: The Easy Way: IDEs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/testing/" title="5.3: The Middle Way: TDD" class="dd-item ">
        <a href="../../ch5-debugging/testing/">
        <i class='far fa-keyboard'></i> 5.3: The Middle Way: TDD
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch5-debugging/debugging-gdb/" title="5.2: The Hard Way: GDB" class="dd-item ">
        <a href="../../ch5-debugging/debugging-gdb/">
        <i class='fas fa-vial'></i> 5.2: The Hard Way: GDB
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch6-tasks/" title="6: Task management" class="dd-item
        
        
        
        ">
      <a href="../../ch6-tasks/">
          <i class='fab fa-linux'></i> 6: Task management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/processes/" title="6.1: Processes" class="dd-item ">
        <a href="../../ch6-tasks/processes/">
        <i class='fas fa-book'></i> 6.1: Processes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab1_processmgmt/" title="6.2: Processes (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab1_processmgmt/">
        <i class='fas fa-vial'></i> 6.2: Processes (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/interprocess/" title="6.3: Inter Process communication" class="dd-item ">
        <a href="../../ch6-tasks/interprocess/">
        <i class='fas fa-book'></i> 6.3: Inter Process communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/threads/" title="6.4: Threads" class="dd-item ">
        <a href="../../ch6-tasks/threads/">
        <i class='fas fa-book'></i> 6.4: Threads
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab2_threadsmgmt/" title="6.5: Threads (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab2_threadsmgmt/">
        <i class='fas fa-vial'></i>6.5: Threads (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/interthread/" title="6.6: Inter Thread communication" class="dd-item ">
        <a href="../../ch6-tasks/interthread/">
        <i class='fas fa-book'></i> 6.6: Inter Thread communication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch6-tasks/lab3_interthreadcomm/" title="6.7: Inter-Thread communication (lab)" class="dd-item ">
        <a href="../../ch6-tasks/lab3_interthreadcomm/">
        <i class='fas fa-vial'></i> 6.7: Inter-Thread communication (lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch7-scheduling/" title="7: CPU scheduling" class="dd-item
        
        
        
        ">
      <a href="../../ch7-scheduling/">
          <i class='fab fa-linux'></i> 7: CPU scheduling
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/algorithms/" title="7.1: Scheduling algorithms" class="dd-item ">
        <a href="../../ch7-scheduling/algorithms/">
        <i class='fas fa-book'></i> 7.1: Scheduling algorithms
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab1_algorithms/" title="7.2: Scheduling algorithms (lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab1_algorithms/">
        <i class='fas fa-vial'></i> 7.2: Scheduling algorithms (lab)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/towards/" title="7.3: Towards real-world schedulers" class="dd-item ">
        <a href="../../ch7-scheduling/towards/">
        <i class='fas fa-book'></i> 7.3: Towards real-world schedulers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch7-scheduling/lab2_niceguy/" title="7.4: Mr. nice guy(lab)" class="dd-item ">
        <a href="../../ch7-scheduling/lab2_niceguy/">
        <i class='fas fa-vial'></i> 7.4: Mr. nice guy(lab)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch8-stack/" title="8: The Stack &amp; The Heap" class="dd-item
        parent
        
        
        ">
      <a href="../../ch8-stack/">
          <i class='far fa-keyboard'></i> 8: The Stack &amp; The Heap
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/stackvsheap/" title="8.1: The Stack &amp; the Heap" class="dd-item ">
        <a href="../../ch8-stack/stackvsheap/">
        <i class='fas fa-book'></i> 8.1: The Stack &amp; the Heap
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/inspection-labs/" title="8.2: Inspecting memory regions" class="dd-item active">
        <a href="../../ch8-stack/inspection-labs/">
        <i class='fas fa-vial'></i> 8.2: Inspecting memory regions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch8-stack/scope/" title="8.3: Different Scopes in C" class="dd-item ">
        <a href="../../ch8-stack/scope/">
        <i class='fas fa-book'></i> 8.3: Different Scopes in C
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ch9-memory/" title="9: Memory Management" class="dd-item
        
        
        
        ">
      <a href="../../ch9-memory/">
          <i class='fab fa-linux'></i> 9: Memory Management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/memory/" title="9.1: Memory management" class="dd-item ">
        <a href="../../ch9-memory/memory/">
        <i class='fas fa-book'></i> 9.1: Memory management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab1_segfault/" title="9.2: Deliberate Segfaulting" class="dd-item ">
        <a href="../../ch9-memory/lab1_segfault/">
        <i class='fas fa-vial'></i> 9.2: Deliberate Segfaulting
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/paging/" title="9.3: Paging" class="dd-item ">
        <a href="../../ch9-memory/paging/">
        <i class='fas fa-book'></i> 9.3: Paging
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ch9-memory/lab2_browsing/" title="9.4: Simply browsing through pages" class="dd-item ">
        <a href="../../ch9-memory/lab2_browsing/">
        <i class='fas fa-vial'></i> 9.4: Simply browsing through pages
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/chx-cs/" title="X: Capita Selecta" class="dd-item
        
        
        
        ">
      <a href="../../chx-cs/">
          <i class='fab fa-linux'></i> X: Capita Selecta
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/rtos/" title="X.2: Real-time Operating Systems" class="dd-item ">
        <a href="../../chx-cs/rtos/">
        <i class='fab fa-linux'></i> X.2: Real-time Operating Systems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/chx-cs/devdrivers/" title="X.3: Device Drivers" class="dd-item ">
        <a href="../../chx-cs/devdrivers/">
        <i class='fab fa-linux'></i> X.3: Device Drivers
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/exercises/" title="A. Assignments" class="dd-item
        
        
        
        ">
      <a href="../../exercises/">
          <i class='fas fa-pencil-alt'></i> A. Assignments
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/exercises/none-yet/" title="None yet!" class="dd-item ">
        <a href="../../exercises/none-yet/">
        <i class='fas fa-pen-square'></i> None yet!
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/appendix/" title="B. Appendix" class="dd-item
        
        
        
        ">
      <a href="../../appendix/">
          <i class='fab fa-github'></i> B. Appendix
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/appendix/reading/" title="1. Recommended reading" class="dd-item ">
        <a href="../../appendix/reading/">
        1. Recommended reading
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/installing/" title="2. Linux Installation Instructions" class="dd-item ">
        <a href="../../appendix/installing/">
        2. Linux Installation Instructions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/appendix/cheat_sheet/" title="Cheat sheet" class="dd-item ">
        <a href="../../appendix/cheat_sheet/">
        Cheat sheet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://uhintra03.uhasselt.be/studiegidswww/opleidingsonderdeel.aspx?a=2019&amp;i=4082&amp;n=4&amp;t=01"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://kuleuven-diepenbeek.github.io/osc-course/TODO"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Operating Systems and C</a> > <a href='../../ch8-stack/'>8: The Stack & The Heap</a> > 8.2: Inspecting memory regions
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#1-no-malloc-no-heap">1. No malloc, no heap</a>
      <ul>
        <li><a href="#11-inspecting-the-stack">1.1 Inspecting the stack</a></li>
      </ul>
    </li>
    <li><a href="#2-malloc-use-heap">2. malloc: use heap</a></li>
    <li><a href="#3-multiple-mallocs">3. multiple mallocs</a></li>
    <li><a href="#4-free">4. Free</a></li>
    <li><a href="#extra-using-valgrind-to-inspect-the-memory-heap">Extra: Using Valgrind to inspect the memory heap</a></li>
    <li><a href="#further-reading">Further Reading</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              8.2: Inspecting memory regions
            </h1>
          

        


<p>Accompanying Screencast:</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://player.vimeo.com/video/400606180" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="vimeo video" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
</div>

<h2 id="1-no-malloc-no-heap">1. No malloc, no heap</h2>
<p>Let&rsquo;s look at memory regions of a process that does not call <code>malloc()</code>.
This means we will not use the heap just yet. Compile the following code:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
    <span style="color:#111">getchar</span><span style="color:#111">();</span>  <span style="color:#75715e">// breaks process until char input
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></div><p>To explore the above example, we will introduce <code>getchar()</code> before ending the <code>main()</code> loop, so the program pauses and gives us a change to look under the hood.</p>

<div class="ex">
	<div class="inner">
    	<p>Inspect the memory regions of the above program while running it. Look up the process ID using <code>ps aux</code> and browse through the files using <code>cat</code> in <code>/proc/[procid]</code>.</p>

	</div>
</div>
<p>Locate the following:</p>
<pre>
7f8122192000-7f8122193000 rw-p 00000000 00:00 0 
7fffc566a000-7fffc568b000 rw-p 00000000 00:00 0                          [stack]
7fffc577d000-7fffc5780000 r--p 00000000 00:00 0                          [vvar]
7fffc5780000-7fffc5782000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
</pre>
<p>No <code>[heap]</code> region allocated yet. Let&rsquo;s do the same, but use <code>malloc()</code> to allocate a random block of memory. The return value of the method is a <code>void*</code> that can be printed to show the address of the heap region. Use <code>printf(&quot;%p&quot;, p)</code>.</p>

<div class="notices warning" ><p>Peeking into the files in <code>/proc</code>, we can sometimes see the heap block not moving <em>at all</em>. It turns out that this is <a href="https://stackoverflow.com/questions/19991623/why-is-malloc-not-using-up-the-memory-on-my-computer">completely OS-dependant</a>. Try to use <code>calloc()</code> instead and see what happens!</p>
</div>

<h3 id="11-inspecting-the-stack">1.1 Inspecting the stack</h3>
<p>See if there&rsquo;s a way to more thoroughly inspect the stack region.</p>
<ol>
<li>Write a small program that fills the stack with a few variables and function calls, then a blocking call to <code>getchar()</code> which gives you time to inspect things.</li>
<li>Check the <code>/proc/{process_id}</code> folder to scour for stack information.</li>
<li>Use the <code>gdb</code> GCC debugger: <code>gdb -batch -ex bt -p {process_id}</code>.</li>
<li>For older 32-bit computers only: use the <a href="https://linux.die.net/man/1/pstack">pstack</a> program to print the stack trace of the running process.</li>
</ol>
<p>Does the output make sense? Are there major differences?</p>
<p>A few tips:</p>
<ul>
<li><em>Operation not permitted</em> problems are usually solved with using <code>sudo</code>!</li>
<li>If you don&rsquo;t know what the arguments of a cmdline program do, use <code>man {cmd}</code> to find out. These are also available online in various mirrors such as <a href="https://linux.die.net/man/1/gdb">linux.die.net</a> for gdb.</li>
</ul>
<p>Another fun exercise: write a never-ending recursive loop and increase a global <code>int</code> variable that gets printed. How far can you get without segfaulting? Re-run the program. Is the maximum number the same? Is this the same on your neighbor&rsquo;s computer?</p>
<h2 id="2-malloc-use-heap">2. malloc: use heap</h2>

<div class="ex">
	<div class="inner">
    	<p>Extend the above example and allocate dynamic memory. What happens in the <code>/proc</code> files? Can you see how the returned address is inside the heap region?</p>

	</div>
</div>
<p>Let us use the program <code>strace</code> to figure out what <code>malloc()</code> exactly does. It should be a system call that asks the Operating System to allocate a certain amount of dynamic memory. But we have yet to figure out <strong>which system calls</strong> exactly are called. The program <code>strace</code> is used to track system calls and signals. Don&rsquo;t be surprised by the amount of calls a simple program like ours makes! Let us try to find the calls for memory allocation.</p>
<p>It is a good idea to <code>printf(&quot;before malloc! &quot;)</code> to make sense of the <code>strace</code> output.</p>

<div class="ex">
	<div class="inner">
    	<p>use <code>strace ./program</code>. It will output a lot of text, ending with <code>read(0,</code> (that is our <code>getchar()</code> break). Can you find the syscalls we are after?</p>

	</div>
</div>
<pre>
munmap(0x7f88a38dc000, 114791)          = 0
brk(NULL)                               = 0x5644fb34d000
brk(0x5644fb36e000)                     = 0x5644fb36e000
fstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 1), ...}) = 0
write(1, "0x5644fb34d260\n", 150x5644fb34d260
)        = 15
fstat(0, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 1), ...}) = 0
read(0,
</pre>
<p>Aha, <code>brk</code>! What is that? Use <code>man brk</code> to find out more.</p>
<p>The data segment gets expanded by moving the <em>program break</em> pointer up, so the heap is actually an extension of the data segment of the program.</p>
<h2 id="3-multiple-mallocs">3. multiple mallocs</h2>
<p>What happens when we call <code>malloc()</code> multiple times in a row?</p>

<div class="ex">
	<div class="inner">
    	<p>Extend the program by allocating <code>1024</code> bytes four times in a row. Inspect the program again using <code>strace</code>. What do you notice?</p>

	</div>
</div>
<p>Memory allocation is optimized by avoiding a system call each time. It firsts allocates more than needed that will (hopefully) suffice.</p>
<p>Instead of calling malloc four times, let&rsquo;s see what happens when we use a loop to see how many times <code>brk</code> is called. More importantly, we will also see that he heap <strong>grows &lsquo;upward&rsquo;</strong>!</p>

<div class="ex">
	<div class="inner">
    	<p>Extend the program by allocating <code>1024</code> bytes in a for loop (Use <code>getchar()</code> before and after the loop) that counts to a random high number. Print &ldquo;loop&rdquo; and &ldquo;end&rdquo; before and after the loop. Inspect again using the trace tool, and also take a look at the maps file in the process folder. After entering a key you can re-inspect everything.</p>

	</div>
</div>
<ul>
<li>Before loop: <code>556a1a947000-556a1a968000 rw-p 00000000 00:00 0                          [heap]</code></li>
<li>After loop: <code>556a1a947000-556a1aa4f000 rw-p 00000000 00:00 0                          [heap]</code></li>
</ul>
<p>Converted to decimal: 93914201911296 - 93914200965120 = 946176 bytes used.</p>
<p>Indeed, the Figure from <a href="../../ch7-stack/stackvsheap">chapter 7.1</a> and our findings confirm that the heap grows upwards.</p>
<h2 id="4-free">4. Free</h2>
<p>Until now the above examples have never taken into consideration the fact that one has to get rid unused space using <code>free()</code>. We will leave it up to you to inspect what happens in <code>/proc</code>.</p>
<h2 id="extra-using-valgrind-to-inspect-the-memory-heap">Extra: Using Valgrind to inspect the memory heap</h2>
<p><figure>
	<a href="../../img/valgrind.png" data-featherlight="image">
		<img src="../../img/valgrind.png"  >
	</a>
	
</figure>
</p>
<p>Valgrind is a useful commandline tool that makes it easy for C programmers to inspect how much dynamic (heap) memory a program actually consumed, and how much of it was freed. It is a lot easier to use than dabbling in different disassemble commands, but it does NOT come with the GNU toolchain. Use <code>apt-get install valgrind</code> to install it onto your virtual machine.</p>
<p>Let&rsquo;s assume a simple program that reserves some memory, fills in the blanks, and then frees up some space: (also available in the <code>osc-exercises</code> repository)</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">int</span><span style="color:#f92672">*</span> <span style="color:#111">ptr</span><span style="color:#111">;</span>
    <span style="color:#111">ptr</span> <span style="color:#f92672">=</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span><span style="color:#111">);</span>
    <span style="color:#75715e">// we allocated 4000 bytes (since an int is usually 4 bytes)
</span><span style="color:#75715e"></span>
    <span style="color:#111">free</span><span style="color:#111">(</span><span style="color:#111">ptr</span><span style="color:#111">);</span>
    <span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></div><p>After compiling this, we can let the tool figure out how much space we took up, how many leaks there were, and much more:</p>
<pre>
Wouters-MacBook-Air:ch8-stack wgroeneveld$ valgrind ./a.out
==87742== Memcheck, a memory error detector
==87742== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==87742== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
==87742== Command: ./a.out
==87742==
--87742-- run: /usr/bin/dsymutil "./a.out"
warning: no debug symbols in executable (-arch x86_64)
==87742==
==87742== HEAP SUMMARY:
==87742==     in use at exit: 22,529 bytes in 188 blocks
==87742==   total heap usage: 268 allocs, 80 frees, 32,649 bytes allocated
==87742==
==87742== LEAK SUMMARY:
==87742==    definitely lost: 3,472 bytes in 55 blocks
==87742==    indirectly lost: 2,832 bytes in 9 blocks
==87742==      possibly lost: 0 bytes in 0 blocks
==87742==    still reachable: 0 bytes in 0 blocks
==87742==         suppressed: 16,225 bytes in 124 blocks
==87742== Rerun with --leak-check=full to see details of leaked memory
==87742==
==87742== For lists of detected and suppressed errors, rerun with: -s
==87742== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
</pre>

<div class="ex">
	<div class="inner">
    	<p>Try to let the above program produce a few memory leaks. Does valgrind notice you did not clean up your mess? The <em>definitely lost</em> amount should skyrocket after a few uncleaned <code>malloc()</code> calls. Are amount of reported bytes correct? Recalculate this manually.</p>

	</div>
</div>
<p>Remember that <code>malloc()</code> calls that aren&rsquo;t assigned <em>could</em> be optimized and removed by the compiler, resulting in no heap reservation at all. Make sure to actually &ldquo;do&rdquo; something with it (e.g. allocate a struct and pass in a few values). See also <a href="../../ch8-stack/stackvsheap/#optimizing-c-code">8.1: Optimizing code</a>.</p>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="https://blog.holbertonschool.com/hack-the-virtual-memory-malloc-the-heap-the-program-break/">Hack the Virtual Memory: malloc, the heap &amp; the program break</a></li>
<li><a href="http://valgrind.org/docs/manual/QuickStart.html">Valgrind quickstart</a></li>
</ul>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../ch8-stack/stackvsheap/" title="8.1: The Stack &amp; the Heap"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../ch8-stack/scope/" title="8.3: Different Scopes in C" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1675691513"></script>
    <script src="../../js/perfect-scrollbar.min.js?1675691513"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1675691513"></script>
    <script src="../../js/jquery.sticky.js?1675691513"></script>
    <script src="../../js/featherlight.min.js?1675691513"></script>
    <script src="../../js/modernizr.custom-3.6.0.js?1675691513"></script>
    <script src="../../js/learn.js?1675691513"></script>
    <script src="../../js/hugo-learn.js?1675691513"></script>
    
        
            <script src="../../mermaid/mermaid.js?1675691513"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    <script>
    window.MathJax = {
      chtml: {
        scale: 2,                      
        minScale: .5,                  
        matchFontHeight: true,         
        mtextInheritFont: false,       
        merrorInheritFont: true,       
        mathmlSpacing: false,          
        skipAttributes: {},            
        exFactor: .5,                  
        displayAlign: 'center',        
        displayIndent: '0'             
      }
    };
    </script>
    
    

  </body>
</html>

